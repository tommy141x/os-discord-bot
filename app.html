<html>
    <head>
        <title>Dashboard</title>
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
        />
        <script
            src="https://code.jquery.com/jquery-3.7.1.min.js"
            integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
            crossorigin="anonymous"
        ></script>
        <link
            rel="stylesheet"
            href="https://unpkg.com/franken-ui-releases@0.0.13/dist/default.min.css"
        />
        <link rel="stylesheet" href="./public/theme.css" />
        <style>
            .sidebar {
                width: 20rem;
                height: 100%;
                padding: 2rem;
                box-sizing: border-box;
                float: left;
                display: flex;
                flex-direction: column;
                align-items: center; /* Centering the buttons vertically */
                overflow-y: auto; /* Added to enable scrolling */
                justify-content: center;
            }
            .sidebar-header {
                margin-bottom: 2rem;
                text-align: center; /* Centering the text horizontally */
            }
            .sidebar-header-title {
                font-size: 1.5rem;
                margin: 0;
            }
            .sidebar-menu {
                padding: 0;
                margin: 0;
                width: 90%;
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
                align-items: center; /* Centering the buttons horizontally */
            }

            body {
                display: flex;
                justify-content: center;
                align-items: center;
                margin: 0;
                padding: 0;
            }

            .page {
                height: 100%;
                width: 80%;
                overflow: auto;
                border-radius: 1rem;
                padding: 1rem;
            }

            *::-webkit-scrollbar {
                display: none;
            }

            #preloader {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                z-index: 9999;
                pointer-events: none; /* Allow clicks to pass through */
            }

            #content {
                display: none;
            }
        </style>
        <script>
            let settings = {};
            let guildData = {};
            let stats = {};
            let controlLogs = {};
            let leaderboard = {};
            let logs = {};

            const apiFetchComplete = new Event("apiFetchComplete");

            let fetchedAPIData = {};
            async function fetchAPIData(tryCache = true) {
                if (!(tryCache && Object.keys(fetchedAPIData).length > 0)) {
                    await fetch("/api/settings")
                        .then((response) => response.json())
                        .then((settingsData) => {
                            fetchedAPIData.settings = settingsData;
                        });
                    await fetch("/api/guild")
                        .then((response) => response.json())
                        .then((fetchedGuildData) => {
                            let {
                                guildData,
                                stats,
                                leaderboard,
                                controlLogs,
                                logs,
                            } = fetchedGuildData;
                            fetchedAPIData.guildData = guildData;
                            fetchedAPIData.stats = stats;
                            fetchedAPIData.leaderboard = leaderboard;
                            fetchedAPIData.logs = logs;
                            fetchedAPIData.controlLogs = controlLogs;
                        })
                        .catch((error) => {
                            console.error("Error fetching data:", error);
                            notify("Failed to load data", "danger");
                        });
                }
                return {
                    settings: fetchedAPIData.settings || {},
                    guildData: fetchedAPIData.guildData || {},
                    stats: fetchedAPIData.stats || {},
                    controlLogs: fetchedAPIData.controlLogs || {},
                    leaderboard: fetchedAPIData.leaderboard || {},
                    logs: fetchedAPIData.logs || {},
                };
            }

            // On page load or when changing themes, best to add inline in `head` to avoid FOUC
            if (
                localStorage.getItem("color-theme") === "dark" ||
                (!("color-theme" in localStorage) &&
                    window.matchMedia("(prefers-color-scheme: dark)").matches)
            ) {
                document.documentElement.classList.add("dark");
            } else {
                document.documentElement.classList.remove("dark");
            }

            $(window).on("load", async function () {
                await fetchAPIData();
                settings = fetchedAPIData.settings || {};
                guildData = fetchedAPIData.guildData || {};
                stats = fetchedAPIData.stats || {};
                controlLogs = fetchedAPIData.controlLogs || {};
                leaderboard = fetchedAPIData.leaderboard || {};
                logs = fetchedAPIData.logs || {};
                document.dispatchEvent(apiFetchComplete);
            });

            document.addEventListener("apiFetchComplete", function () {
                setTimeout(() => {
                    $("#preloader").fadeOut(1000, function () {
                        $(this).hide();
                        $("#content").show();
                    });
                }, 250);
            });
        </script>
    </head>
    <body class="uk-background-default">
        <div id="preloader" class="uk-background-default"></div>
        <div class="sidebar">
            <div class="sidebar-header">
                <h1 class="uk-h1 sidebar-header-title text-foreground">
                    OS Discord Bot
                </h1>
            </div>
            <div class="sidebar-menu">
                <button
                    class="uk-width-1-1 uk-button uk-button-secondary"
                    onclick="showDiv('overview')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: home; ratio: 0.8"
                    ></span>
                    Overview
                </button>
                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('server-settings')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: cog; ratio: 0.8"
                    ></span>
                    Server Settings
                </button>
                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('embed-messages')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: grid; ratio: 0.8"
                    ></span>
                    Embed Messages
                </button>
                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('utility')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: crosshairs; ratio: 0.8"
                    ></span>
                    Utility
                </button>
                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('moderation')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: ban; ratio: 0.8"
                    ></span>
                    Moderation
                </button>
                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('automod')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: lock; ratio: 0.8"
                    ></span>
                    AutoMod
                </button>
                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('welcome-goodbye')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: social; ratio: 0.8"
                    ></span>
                    Welcome/Goodbye
                </button>
                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('auto-responder')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: reply; ratio: 0.8"
                    ></span>
                    Auto Responder
                </button>
                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('auto-roles')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: users; ratio: 0.8"
                    ></span>
                    Auto Roles
                </button>
                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('logs')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: database; ratio: 0.8"
                    ></span>
                    Logs
                </button>
                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('temporary-channels')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: tag; ratio: 0.8"
                    ></span>
                    Temporary Channels
                </button>
                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('ai-chatbot')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: world; ratio: 0.8"
                    ></span>
                    Artificial Intelligence
                </button>
                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('social-alerts')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: bell; ratio: 0.8"
                    ></span>
                    Social Alerts
                </button>
                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('control-panel-logs')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: rss; ratio: 0.8"
                    ></span>
                    Control Panel Logs
                </button>

                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('bot-settings')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: code; ratio: 0.8"
                    ></span>
                    Bot Settings
                </button>
                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('mod-actions')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: history; ratio: 0.8"
                    ></span>
                    Audit Log
                </button>
            </div>
            <style>
                .user-profile {
                    display: flex;
                    align-items: center;
                    padding: 10px;
                    border-radius: 5px;
                    margin-top: 10px;
                }

                .user-profile:hover {
                    cursor: default;
                }

                .avatar-container {
                    position: relative;
                    margin-right: 10px;
                }

                .avatar {
                    width: 32px;
                    height: 32px;
                    border-radius: 50%;
                }

                .status-indicator {
                    position: absolute;
                    bottom: 0;
                    right: 0;
                    width: 14px;
                    height: 14px;
                    background-color: #43b581;
                    border-radius: 50%;
                    border: 2px solid #2c2f33;
                }

                .user-info {
                    display: flex;
                    flex-direction: column;
                }

                .username {
                    font-weight: bold;
                }

                .user-status {
                    font-size: 0.8em;
                }
            </style>
            <div
                class="user-profile uk-background-muted uk-width-1-1"
                style="width: 90%"
            >
                <div class="avatar-container">
                    <img src="" alt="User Avatar" class="avatar" />
                    <div class="status-indicator"></div>
                </div>
                <div class="user-info uk-text text-primary">
                    <div class="username text-foreground">Tommy</div>
                    <div class="user-status text-foreground">
                        ill be on tmrw night...
                    </div>
                </div>
            </div>
            <script>
                function updateUserProfile() {
                    fetch("/api/user")
                        .then((response) => {
                            if (!response.ok) {
                                throw new Error("Network response was not ok");
                            }
                            return response.json();
                        })
                        .then((data) => {
                            // Update the avatar
                            const avatarImg = document.querySelector(".avatar");
                            avatarImg.src = data.avatar;
                            avatarImg.alt = `${data.name}'s avatar`;

                            // Update the username
                            const usernameDiv =
                                document.querySelector(".username");
                            usernameDiv.textContent = data.name;

                            // Update the user status
                            const userStatusDiv =
                                document.querySelector(".user-status");
                            userStatusDiv.textContent =
                                data.onlineStatus || "Viewing Dashboard";

                            // Update the status indicator
                            const statusIndicator =
                                document.querySelector(".status-indicator");
                            statusIndicator.style.backgroundColor =
                                getStatusColor(data.status);
                        })
                        .catch((error) => {
                            console.error("Error fetching user data:", error);
                            // Optionally, update the UI to show an error state
                        });
                }

                function getStatusColor(status) {
                    switch (status) {
                        case "online":
                            return "#43b581";
                        case "idle":
                            return "#faa61a";
                        case "dnd":
                            return "#f04747";
                        case "offline":
                        default:
                            return "#747f8d";
                    }
                }

                // Call this function when the page loads
                document.addEventListener(
                    "apiFetchComplete",
                    updateUserProfile,
                );
            </script>
            <div
                style="
                    display: flex;
                    width: 90%;
                    align-items: center;
                    justify-content: space-between;
                    margin-top: 1rem;
                "
            >
                <button
                    class="uk-width-1-1 uk-button uk-button-danger"
                    onclick="logout()"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: sign-out; ratio: 0.8"
                    ></span>
                    Logout
                </button>
                <style>
                    #theme-toggle:hover {
                        cursor: pointer;
                    }
                </style>
                <a
                    id="theme-toggle"
                    class="uk-icon-button; text-foreground"
                    style="margin-left: 1rem"
                    uk-icon="paint-bucket"
                ></a>
                <script>
                    var themeToggleBtn =
                        document.getElementById("theme-toggle");

                    themeToggleBtn.addEventListener("click", function () {
                        // if set via local storage previously
                        if (localStorage.getItem("color-theme")) {
                            if (
                                localStorage.getItem("color-theme") === "light"
                            ) {
                                document.documentElement.classList.add("dark");
                                localStorage.setItem("color-theme", "dark");
                            } else {
                                document.documentElement.classList.remove(
                                    "dark",
                                );
                                localStorage.setItem("color-theme", "light");
                            }

                            // if NOT set via local storage previously
                        } else {
                            if (
                                document.documentElement.classList.contains(
                                    "dark",
                                )
                            ) {
                                document.documentElement.classList.remove(
                                    "dark",
                                );
                                localStorage.setItem("color-theme", "light");
                            } else {
                                document.documentElement.classList.add("dark");
                                localStorage.setItem("color-theme", "dark");
                            }
                        }
                    });
                </script>
            </div>
        </div>
        <div id="overview" class="page uk-background">
            <link
                rel="stylesheet"
                href="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.css"
            />
            <script src="//cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/chartist-plugin-pointlabels@0.0.6/dist/chartist-plugin-pointlabels.min.js"></script>
            <style>
                .card-container-overview {
                    display: grid;
                    grid-template-columns: repeat(3, 1fr);
                    grid-template-rows: 2fr 3fr; /* First row 2/3 height of second row */
                    gap: 1rem;
                    padding: 1rem;
                    height: 90%; /* Make container take full height */
                }

                .uk-card-overview {
                    height: 100%; /* Make cards take full height */
                    overflow: hidden; /* Ensure cards do not scroll */
                }

                .card-overlay {
                    position: absolute;
                    top: 1rem;
                    left: 1rem;
                    font-size: 1.5rem;
                    font-weight: bold;
                    z-index: 10;
                }
                .ct-chart {
                    position: absolute;
                    width: 102%;
                    height: 80%;
                    bottom: -1%;
                    left: -1%;
                }
                .ct-series-a .ct-line,
                .ct-series-a .ct-point {
                    stroke: hsl(var(--foreground)) !important;
                }
                .ct-series-a .ct-area {
                    fill: hsl(var(--primary)) !important;
                }
                .ct-label {
                    color: hsl(var(--foreground)) !important;
                    fill: hsl(var(--foreground)) !important;
                }
                .header-container {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 1rem;
                }
                .guild-info {
                    display: flex;
                    align-items: center;
                    gap: 1rem;
                }
            </style>

            <div class="header-container">
                <div class="guild-info">
                    <img
                        id="guildIcon"
                        src=""
                        alt="Guild Icon"
                        class="uk-border-circle"
                        width="64"
                        height="64"
                    />
                    <h2 id="guildName" class="uk-h1 text-foreground"></h2>
                </div>
            </div>

            <div class="card-container-overview">
                <div
                    class="uk-card uk-card-overview uk-card-default uk-card-body"
                >
                    <div class="card-overlay" id="totalMembersText">
                        0 Total Members
                    </div>
                    <div class="ct-chart" id="totalMembersChart"></div>
                </div>
                <div
                    class="uk-card uk-card-overview uk-card-default uk-card-body"
                >
                    <div class="card-overlay" id="onlineMembersText">
                        Online Members: 0
                    </div>
                    <div class="ct-chart" id="onlineMembersChart"></div>
                </div>
                <div
                    class="uk-card uk-card-overview uk-card-default uk-card-body"
                >
                    <div class="card-overlay" id="messages24HoursText">
                        Messages (Last 24 Hours): 0
                    </div>
                    <div class="ct-chart" id="messagesChart"></div>
                </div>

                <!-- Leaderboard Cards -->
                <div
                    class="uk-card uk-card-overview uk-card-default uk-card-body"
                >
                    <div class="card-overlay">Message Leaderboard</div>
                    <table
                        class="uk-table uk-table-hover uk-text text-primary"
                        style="margin-top: 2.8rem"
                    >
                        <thead>
                            <tr>
                                <th>Member</th>
                                <th>Messages</th>
                            </tr>
                        </thead>
                        <tbody id="topMessagePointsTable">
                            <!-- Leaderboard rows will be inserted here -->
                        </tbody>
                    </table>
                </div>
                <div
                    class="uk-card uk-card-overview uk-card-default uk-card-body"
                >
                    <div class="card-overlay">Voice Leaderboard</div>
                    <table
                        class="uk-table uk-table-hover uk-text text-primary"
                        style="margin-top: 2.8rem"
                    >
                        <thead>
                            <tr>
                                <th>Member</th>
                                <th>Voice Time (s)</th>
                            </tr>
                        </thead>
                        <tbody id="topVoicePointsTable">
                            <!-- Leaderboard rows will be inserted here -->
                        </tbody>
                    </table>
                </div>
                <div
                    class="uk-card uk-card-overview uk-card-default uk-card-body"
                >
                    <div class="card-overlay">Overall Leaderboard</div>
                    <table
                        class="uk-table uk-table-hover uk-text text-primary"
                        style="margin-top: 2.8rem"
                    >
                        <thead>
                            <tr>
                                <th>Member</th>
                                <th>Total Points</th>
                            </tr>
                        </thead>
                        <tbody id="topTotalPointsTable">
                            <!-- Leaderboard rows will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <script>
                document.addEventListener("apiFetchComplete", async () => {
                    // Update guild information
                    document.getElementById("guildIcon").src = guildData.icon;
                    document.getElementById("guildName").textContent =
                        guildData.name;

                    logs = logs || [];
                    stats = stats || [];
                    leaderboard = leaderboard || [];

                    const totalMembers =
                        stats[stats.length - 1]?.totalMembers || 0;
                    const onlineMembers =
                        stats[stats.length - 1]?.onlineMembers || 0;

                    document.getElementById("totalMembersText").textContent =
                        `${totalMembers} Total Members`;
                    document.getElementById("onlineMembersText").textContent =
                        `${onlineMembers} Online Members`;
                    const now = new Date();
                    const past24Hours = new Date(
                        now.getTime() - 24 * 60 * 60 * 1000,
                    );

                    const messagesLast24Hours = logs.filter(
                        (log) =>
                            log.type === "new-message" &&
                            new Date(log.timestamp) >= past24Hours,
                    ).length;

                    document.getElementById("messages24HoursText").textContent =
                        `Messages (Last 24 Hours): ${messagesLast24Hours}`;

                    // Filter stats to only include data from the past 24 hours
                    const filteredStats = stats.filter(
                        (stat) => new Date(stat.timestamp) >= past24Hours,
                    );

                    const filteredLogs = logs.filter(
                        (log) => new Date(log.timestamp) >= past24Hours,
                    );

                    // Chart Data
                    const labels = downsampleArray(
                        filteredStats.map((stat) =>
                            new Date(stat.timestamp).toLocaleTimeString(),
                        ),
                    );
                    const totalMembersData = downsampleArray(
                        stats.map((stat) => stat.totalMembers),
                    );

                    const onlineMembersData = downsampleArray(
                        filteredStats.map((stat) => stat.onlineMembers),
                    );
                    const messagesData = createMessageDataFor24Hours(logs, 10);

                    function downsampleArray(arr, maxPoints = 10) {
                        if (arr.length <= maxPoints) {
                            return arr;
                        }

                        const step = Math.ceil(arr.length / maxPoints);
                        const downsampledStats = [];

                        for (let i = 0; i < arr.length; i += step) {
                            downsampledStats.push(arr[i]);
                        }

                        return downsampledStats;
                    }

                    function downsampleArrayWithSumming(arr, maxPoints = 10) {
                        if (arr.length <= maxPoints) {
                            return arr;
                        }
                        const groupSize = Math.ceil(arr.length / maxPoints);
                        const downsampledArray = [];
                        for (let i = 0; i < arr.length; i += groupSize) {
                            const group = arr.slice(i, i + groupSize);
                            const sum = group.reduce(
                                (sum, value) => sum + value,
                                0,
                            );
                            downsampledArray.push(sum);
                        }
                        return downsampledArray;
                    }

                    function createMessageDataFor24Hours(
                        logs,
                        numPeriods = 10,
                    ) {
                        const now = new Date();
                        const past24Hours = new Date(now - 24 * 60 * 60 * 1000);
                        const periodDuration =
                            (24 * 60 * 60 * 1000) / numPeriods; // duration of each period in milliseconds

                        const messagesData = new Array(numPeriods).fill(0);

                        logs.forEach((log) => {
                            if (log.type === "new-message") {
                                const logTime = new Date(log.timestamp);
                                if (logTime >= past24Hours && logTime <= now) {
                                    const periodIndex = Math.floor(
                                        (logTime - past24Hours) /
                                            periodDuration,
                                    );
                                    if (periodIndex < numPeriods) {
                                        messagesData[periodIndex]++;
                                    }
                                }
                            }
                        });

                        return messagesData;
                    }

                    // Function to create and configure a Chartist line chart
                    function createChart(chartId, labels, seriesData) {
                        var chart = new Chartist.Line(
                            chartId,
                            {
                                labels: labels,
                                series: [seriesData],
                            },
                            {
                                showPoint: true,
                                lineSmooth: Chartist.Interpolation.simple({
                                    divisor: 2,
                                }),
                                showArea: true,
                                fullWidth: true,
                                showLabel: false,
                                axisX: {
                                    showGrid: false,
                                    showLabel: false,
                                    offset: 0,
                                },
                                axisY: {
                                    showGrid: false,
                                    showLabel: false,
                                    offset: 0,
                                },
                                chartPadding: {
                                    top: 40,
                                    right: 0,
                                    bottom: 6,
                                    left: 0,
                                },
                                low: 0,
                                plugins: [
                                    Chartist.plugins.ctPointLabels({
                                        textAnchor: "middle",
                                        labelInterpolationFnc: function (
                                            value,
                                        ) {
                                            return Math.round(value) || 0;
                                        },
                                    }),
                                ],
                            },
                        );

                        chart.on("draw", function (data) {
                            if (data.type === "line" || data.type === "area") {
                                data.element.animate({
                                    d: {
                                        begin: 2000 * data.index,
                                        dur: 2000,
                                        from: data.path
                                            .clone()
                                            .scale(1, 0)
                                            .translate(
                                                0,
                                                data.chartRect.height(),
                                            )
                                            .stringify(),
                                        to: data.path.clone().stringify(),
                                        easing: Chartist.Svg.Easing
                                            .easeOutQuint,
                                    },
                                });
                            }
                        });

                        return chart;
                    }

                    // Create charts using the function
                    var totalMembersChart = createChart(
                        "#totalMembersChart",
                        labels,
                        totalMembersData,
                    );
                    var onlineMembersChart = createChart(
                        "#onlineMembersChart",
                        labels,
                        onlineMembersData,
                    );
                    var messagesChart = createChart(
                        "#messagesChart",
                        labels,
                        messagesData,
                    );

                    // Update Leaderboards
                    const topMessagePointsTable = document.getElementById(
                        "topMessagePointsTable",
                    );
                    const topVoicePointsTable = document.getElementById(
                        "topVoicePointsTable",
                    );
                    const topTotalPointsTable = document.getElementById(
                        "topTotalPointsTable",
                    );

                    leaderboard.topMessagePoints.forEach((member, index) => {
                        topMessagePointsTable.insertAdjacentHTML(
                            "beforeend",
                            `
                                    <tr>
                                        <td style="display: flex; align-items: center; vertical-align: middle;" class="text-foreground">
                                            <img src="${member.avatarURL}" alt="${member.displayName}" width="32" height="32" class="uk-border-circle" style="margin-right: 8px;">
                                            ${member.displayName}
                                        </td>
                                        <td style="vertical-align: middle;" class="text-foreground">
                                            ${member.messages}
                                        </td>
                                    </tr>

                            `,
                        );
                    });

                    leaderboard.topVoicePoints.forEach((member, index) => {
                        const hours = Math.floor(member.voiceTime / 3600);
                        const minutes = Math.floor(
                            (member.voiceTime % 3600) / 60,
                        );
                        topVoicePointsTable.insertAdjacentHTML(
                            "beforeend",
                            `
                                <tr>
                                    <td style="display: flex; align-items: center; vertical-align: middle;" class="text-foreground">
                                        <img src="${member.avatarURL}" alt="${member.displayName}" width="32" height="32" class="uk-border-circle" style="margin-right: 8px;">
                                        ${member.displayName}
                                    </td>
                                    <td style="vertical-align: middle;" class="text-foreground">
                                        ${hours} hours ${minutes} minutes
                                    </td>
                                </tr>

                            `,
                        );
                    });

                    leaderboard.topTotalPoints.forEach((member, index) => {
                        topTotalPointsTable.insertAdjacentHTML(
                            "beforeend",
                            `
                                <tr>
                                    <td style="display: flex; align-items: center; vertical-align: middle;" class="text-foreground">
                                        <img src="${member.avatarURL}" alt="${member.displayName}" width="32" height="32" class="uk-border-circle" style="margin-right: 8px;">
                                        ${member.displayName}
                                    </td>
                                    <td style="vertical-align: middle;" class="text-foreground">
                                        ${member.total}
                                    </td>
                                </tr>

                            `,
                        );
                    });
                });
            </script>
        </div>

        <div id="server-settings" class="page uk-background">
            <h1 class="uk-h1 text-foreground" style="margin: 1rem">
                Server Settings
            </h1>
            <div
                id="serverSettingsForm"
                class="uk-card uk-card-default uk-card-body"
            >
                <input type="hidden" id="guildId" value="<%= guild.id %>" />

                <div class="uk-margin">
                    <label
                        class="uk-form-label"
                        for="defaultMessageNotifications"
                        >Default Notification Settings:</label
                    >
                    <select
                        class="uk-select"
                        id="defaultMessageNotifications"
                        name="defaultMessageNotifications"
                    >
                        <option value="0">All Messages</option>
                        <option value="1">Only @mentions</option>
                    </select>
                </div>

                <div class="uk-margin">
                    <label class="uk-form-label" for="explicitContentFilter"
                        >Explicit Content Filter:</label
                    >
                    <select
                        class="uk-select"
                        id="explicitContentFilter"
                        name="explicitContentFilter"
                    >
                        <option value="0">Disabled</option>
                        <option value="1">Members without roles</option>
                        <option value="2">All members</option>
                    </select>
                </div>

                <div class="uk-margin">
                    <label class="uk-form-label" for="systemChannelId"
                        >System Messages Channel:</label
                    >
                    <select
                        class="uk-select"
                        id="systemChannelId"
                        name="systemChannelId"
                    >
                        <option value="">Select a channel</option>
                        <!-- Options will be dynamically populated -->
                    </select>
                </div>

                <div class="uk-margin">
                    <label class="uk-form-label checkbox-label">
                        <input
                            class="uk-checkbox"
                            type="checkbox"
                            id="sendWelcomeMessage"
                            name="sendWelcomeMessage"
                        />
                        Send a random welcome message when someone joins this
                        server.
                    </label>
                </div>

                <div class="uk-margin">
                    <label class="uk-form-label checkbox-label">
                        <input
                            class="uk-checkbox"
                            type="checkbox"
                            id="promptWelcomeSticker"
                            name="promptWelcomeSticker"
                        />
                        Prompt members to reply to welcome messages with a
                        sticker.
                    </label>
                </div>

                <div class="uk-margin">
                    <label class="uk-form-label checkbox-label">
                        <input
                            class="uk-checkbox"
                            type="checkbox"
                            id="sendBoostMessage"
                            name="sendBoostMessage"
                        />
                        Send a message when someone boosts this server.
                    </label>
                </div>

                <div class="uk-margin">
                    <label class="uk-form-label checkbox-label">
                        <input
                            class="uk-checkbox"
                            type="checkbox"
                            id="sendHelpfulTips"
                            name="sendHelpfulTips"
                        />
                        Send helpful tips for server setup.
                    </label>
                </div>

                <div class="uk-margin">
                    <label class="uk-form-label checkbox-label">
                        <input
                            class="uk-checkbox"
                            type="checkbox"
                            id="sendPurchaseMessage"
                            name="sendPurchaseMessage"
                        />
                        Send a message when someone purchases a Server Product
                        or Server Subscription.
                    </label>
                </div>

                <div class="uk-margin">
                    <label class="uk-form-label checkbox-label">
                        <input
                            class="uk-checkbox"
                            type="checkbox"
                            id="promptSubscriptionSticker"
                            name="promptSubscriptionSticker"
                        />
                        Prompt members to reply to Server Subscription
                        congratulation messages with a sticker.
                    </label>
                </div>

                <div class="uk-card-footer uk-flex uk-flex-between">
                    <button
                        type="button"
                        class="uk-button uk-button-default"
                        id="updateButton"
                    >
                        Save Settings
                    </button>
                </div>
            </div>

            <script>
                document.addEventListener("apiFetchComplete", async () => {
                    // Populate the system channel dropdown
                    const systemChannelDropdown =
                        document.getElementById("systemChannelId");
                    guildData.channels.forEach((channel) => {
                        if (channel.type === 0) {
                            // 0 is the type for text channels
                            const option = document.createElement("option");
                            option.value = channel.id;
                            option.textContent =
                                "#" + channel.name + " - (" + channel.id + ")";
                            systemChannelDropdown.appendChild(option);
                        }
                    });

                    // Set the selected option
                    systemChannelDropdown.value =
                        guildData.systemChannelId || "";

                    // Rest of the code remains the same
                    document.getElementById(
                        "defaultMessageNotifications",
                    ).value = guildData.defaultMessageNotifications;
                    document.getElementById("explicitContentFilter").value =
                        guildData.explicitContentFilter;
                    document.getElementById("sendWelcomeMessage").checked =
                        guildData.sendWelcomeMessage;
                    document.getElementById("promptWelcomeSticker").checked =
                        guildData.promptWelcomeSticker;
                    document.getElementById("sendBoostMessage").checked =
                        guildData.sendBoostMessage;
                    document.getElementById("sendPurchaseMessage").checked =
                        guildData.sendPurchaseMessage;
                    document.getElementById(
                        "promptSubscriptionSticker",
                    ).checked = guildData.promptSubscriptionSticker;
                    document.getElementById("sendHelpfulTips").checked =
                        guildData.sendHelpfulTips;

                    document
                        .getElementById("updateButton")
                        .addEventListener("click", async () => {
                            const updatedData = {
                                defaultMessageNotifications:
                                    document.getElementById(
                                        "defaultMessageNotifications",
                                    ).value,
                                explicitContentFilter: document.getElementById(
                                    "explicitContentFilter",
                                ).value,
                                systemChannelId:
                                    document.getElementById("systemChannelId")
                                        .value,
                                preferredLocale: guildData.preferredLocale,
                                sendWelcomeMessage:
                                    document.getElementById(
                                        "sendWelcomeMessage",
                                    ).checked,
                                promptWelcomeSticker: document.getElementById(
                                    "promptWelcomeSticker",
                                ).checked,
                                sendBoostMessage:
                                    document.getElementById("sendBoostMessage")
                                        .checked,
                                sendPurchaseMessage: document.getElementById(
                                    "sendPurchaseMessage",
                                ).checked,
                                promptSubscriptionSticker:
                                    document.getElementById(
                                        "promptSubscriptionSticker",
                                    ).checked,
                                sendHelpfulTips:
                                    document.getElementById("sendHelpfulTips")
                                        .checked,
                            };

                            const updateResponse = await fetch(`/api/guild`, {
                                method: "POST",
                                headers: {
                                    "Content-Type": "application/json",
                                },
                                body: JSON.stringify(updatedData),
                            });

                            if (updateResponse.ok) {
                                UIkit.notification({
                                    message:
                                        "<div class='uk-flex uk-flex-middle'><span class='uk-flex-none uk-margin-small-right' uk-icon='icon: check; ratio: 0.8'></span> Successfully updated settings.</div>",
                                });
                            } else {
                                UIkit.notification({
                                    message: "There was an error!",
                                });
                            }
                        });
                });
            </script>
        </div>
        <div id="embed-messages" class="page uk-background">
            <link
                rel="stylesheet"
                href="https://cdn.jsdelivr.net/gh/mdbassit/Coloris@latest/dist/coloris.min.css"
            />
            <script src="https://cdn.jsdelivr.net/gh/mdbassit/Coloris@latest/dist/coloris.min.js"></script>
            <link
                href="https://unpkg.com/filepond/dist/filepond.css"
                rel="stylesheet"
            />
            <link
                href="https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.css"
                rel="stylesheet"
            />
            <script src="https://unpkg.com/filepond-plugin-file-validate-type/dist/filepond-plugin-file-validate-type.js"></script>
            <script src="https://unpkg.com/filepond-plugin-image-preview/dist/filepond-plugin-image-preview.js"></script>
            <script src="https://unpkg.com/filepond-plugin-file-validate-size/dist/filepond-plugin-file-validate-size.js"></script>
            <script src="https://unpkg.com/filepond/dist/filepond.js"></script>
            <h1 class="uk-h1 text-foreground" style="margin: 1rem">
                Embed Settings
            </h1>
            <form
                id="embedSettingsForm"
                class="uk-card uk-card-default uk-card-body"
            >
                <div class="uk-margin">
                    <label class="uk-form-label" for="existingEmbeds"
                        >Select Embed to Update:</label
                    >
                    <select class="uk-select" id="existingEmbeds">
                        <option value="">Select Embed</option>
                    </select>
                </div>
                <div class="uk-margin">
                    <label class="uk-form-label" for="channelID"
                        >Channel:</label
                    >
                    <select class="uk-select" id="channelID" name="channelID">
                        <option value="">Select a channel</option>
                    </select>
                </div>

                <div class="uk-margin">
                    <label class="uk-form-label" for="embedColor">Color:</label>
                    <input type="text" id="embedColor" data-coloris />
                </div>

                <div
                    style="
                        display: flex;
                        align-items: center;
                        justify-content: space-between;
                    "
                >
                    <div style="height: 3rem; width: 3rem">
                        <input
                            type="file"
                            class="filepond"
                            name="authorIcon"
                            accept="image/*"
                        />
                    </div>

                    <div style="margin-left: 1rem">
                        <input
                            class="uk-input"
                            type="text"
                            id="authorName"
                            name="authorName"
                            placeholder="Name"
                        />
                    </div>

                    <div style="height: 6rem; width: 6rem; margin-left: auto">
                        <input
                            type="file"
                            class="filepond"
                            name="thumbnail"
                            accept="image/*"
                        />
                    </div>
                </div>

                <div class="uk-margin">
                    <input
                        class="uk-input"
                        type="text"
                        id="embedTitle"
                        name="embedTitle"
                        placeholder="Title"
                    />
                </div>

                <div class="uk-margin">
                    <textarea
                        class="uk-textarea"
                        id="embedDescription"
                        name="embedDescription"
                        rows="3"
                        placeholder="Description"
                    ></textarea>
                </div>

                <div class="uk-margin">
                    <div id="embedFieldsContainer"></div>
                    <button
                        type="button"
                        class="uk-button uk-button-default"
                        id="addFieldButton"
                    >
                        Add Field
                    </button>
                </div>

                <div class="uk-margin" style="height: 15rem">
                    <input
                        type="file"
                        class="filepond"
                        name="mainImage"
                        accept="image/*"
                    />
                </div>

                <div class="uk-margin">
                    <input
                        class="uk-input"
                        type="text"
                        id="embedFooter"
                        name="embedFooter"
                        placeholder="Footer"
                    />
                </div>

                <div class="uk-margin">
                    <label class="uk-form-label checkbox-label">
                        <input
                            class="uk-checkbox"
                            type="checkbox"
                            id="includeTimestamp"
                            name="includeTimestamp"
                        />
                        Timestamp
                    </label>
                </div>

                <input type="hidden" id="messageID" name="messageID" />

                <div class="uk-card-footer uk-flex uk-flex-between">
                    <button
                        type="button"
                        class="uk-button uk-button-primary"
                        id="submitButton"
                    >
                        Send Embed
                    </button>
                    <button
                        type="button"
                        class="uk-button uk-button-danger"
                        id="deleteButton"
                        style="display: none"
                    >
                        Delete Embed
                    </button>
                </div>
            </form>

            <style>
                .filepond--root {
                    height: 100%;
                    width: 100%;
                    margin: 0 !important;
                }

                .filepond--list-scroller {
                    margin: 0 !important;
                    height: 100% !important;
                    width: 100% !important;
                }

                .filepond--list {
                    position: relative !important;
                    left: 0 !important;
                    width: 100%;
                    height: 100%;
                }

                .filepond--item {
                    width: 100% !important;
                    height: 100% !important;
                    position: relative;
                }

                .filepond--panel-root {
                    background-color: transparent;
                    border: 2px solid;
                    border-color: hsl(var(--border)) !important;
                    position: relative;
                }

                .filepond--drop-label {
                    display: none;
                }

                .filepond--root:hover .filepond--panel-root {
                    border-color: hsl(var(--primary)) !important;
                    background-color: hsla(var(--muted), 0.8) !important;
                }

                .filepond--credits {
                    display: none;
                }

                #embedColor {
                    background-color: var(--background);
                    border-width: 0.1rem;
                    border-style: solid;
                    border-color: hsl(var(--border)) !important;
                    border-radius: 0.5rem;
                }
            </style>
            <script>
                // Initialize FilePond for all file inputs
                FilePond.registerPlugin(
                    FilePondPluginFileValidateSize,
                    FilePondPluginFileValidateType,
                    FilePondPluginImagePreview,
                );

                // Global variables
                let ponds = [];
                let channels = [];
                let selectedMessageID = null;
                let fileUploadsInProgress = 0;

                // Utility functions
                const generateUniqueId = () =>
                    Date.now().toString(36) +
                    Math.random().toString(36).substr(2);

                // FilePond initialization and configuration
                const initializeFilePond = (input) => {
                    const pond = FilePond.create(input);
                    pond.setOptions({
                        maxFileSize: "5MB",
                        acceptedFileTypes: ["image/*"],
                        credits: [],
                        server: {
                            process: handleFilePondUpload,
                            revert: handleFilePondRevert,
                            load: (src, load) =>
                                fetch(src)
                                    .then((res) => res.blob())
                                    .then(load),
                        },
                        onaddfile: () => {
                            fileUploadsInProgress++;
                            updateSubmitButtonState();
                        },
                        onremovefile: (err, data) => {
                            $("#embedSettingsForm").removeAttr(
                                `data-${data.file.name.split("-")[0]}-url`,
                            );
                            fileUploadsInProgress--;
                            updateSubmitButtonState();
                        },
                    });
                    // Create image object
                    const imageIcon = document.createElement("span");
                    imageIcon.setAttribute(
                        "uk-icon",
                        "icon: image; ratio: 1.5",
                    );
                    imageIcon.style.position = "absolute";
                    imageIcon.style.top = "50%";
                    imageIcon.style.left = "50%";
                    imageIcon.style.transform = "translate(-50%, -50%)";

                    pond.element.appendChild(imageIcon);
                    pond.element.addEventListener("click", () => {
                        pond.browse();
                    });
                    return pond;
                };

                const handleFilePondUpload = (
                    fieldName,
                    file,
                    metadata,
                    load,
                    error,
                    progress,
                    abort,
                ) => {
                    const formData = new FormData();
                    const uniqueId = generateUniqueId();
                    const fileExtension = file.name.split(".").pop();
                    formData.append(
                        "filepond",
                        file,
                        `${fieldName}-${uniqueId}.${fileExtension}`,
                    );

                    const request = new XMLHttpRequest();
                    request.open("POST", "/api/media");
                    request.upload.onprogress = (e) =>
                        progress(e.lengthComputable, e.loaded, e.total);
                    request.onload = () => {
                        if (request.status >= 200 && request.status < 300) {
                            const response = JSON.parse(request.responseText);
                            load(response.url);
                            $("#embedSettingsForm").attr(
                                `data-${fieldName}-url`,
                                response.url,
                            );
                            fileUploadsInProgress--;
                            updateSubmitButtonState();
                        } else {
                            error("Upload failed");
                            fileUploadsInProgress--;
                            updateSubmitButtonState();
                        }
                    };
                    request.send(formData);
                    return {
                        abort: () => {
                            request.abort();
                            abort();
                        },
                    };
                };

                const handleFilePondRevert = (uniqueFileId, load, error) => {
                    if ($("#embedSettingsForm").attr("reset-inprogress"))
                        return;
                    const fileName = uniqueFileId.split("/").pop();
                    $("#embedSettingsForm").removeAttr(
                        `data-${fileName.split("-")[0]}-url`,
                    );
                    fetch(`/api/media/${fileName}`, { method: "DELETE" })
                        .then((response) => response.json())
                        .then((result) => {
                            result.message === "File deleted successfully"
                                ? load()
                                : error("File deletion failed");
                        })
                        .catch((err) => {
                            console.error("Error:", err);
                            error("File deletion failed");
                        });
                };

                // Initialize FilePond for all file inputs
                const initializeAllFilePonds = () => {
                    const fileInputs = document.querySelectorAll(
                        'input[type="file"].filepond',
                    );
                    const ponds = {};
                    fileInputs.forEach((input) => {
                        ponds[input.name] = initializeFilePond(input);
                    });
                    return ponds;
                };

                // API calls
                const fetchChannels = () => {
                    channels = guildData.channels.filter(
                        (channel) => channel.type === 0,
                    );
                    populateChannelDropdown();
                };

                const fetchEmbeds = async () => {
                    try {
                        const response = await fetch("/api/embeds");
                        const embeds = await response.json();
                        populateEmbedDropdown(embeds);
                    } catch (error) {
                        console.error("Failed to fetch embeds", error);
                    }
                };

                // DOM manipulation functions
                const populateChannelDropdown = () => {
                    const channelDropdown =
                        document.getElementById("channelID");
                    channelDropdown.innerHTML =
                        '<option value="">Select a channel</option>';
                    channels.forEach((channel) => {
                        const option = document.createElement("option");
                        option.value = channel.id;
                        option.textContent = `#${channel.name} (${channel.id})`;
                        channelDropdown.appendChild(option);
                    });
                };

                const populateEmbedDropdown = (embeds) => {
                    const select = document.getElementById("existingEmbeds");
                    select.innerHTML = '<option value="">Select Embed</option>';
                    Object.entries(embeds).forEach(([messageID, embedData]) => {
                        const option = document.createElement("option");
                        option.value = messageID;
                        option.textContent = `${embedData.title} - ${messageID}`;
                        select.appendChild(option);
                    });

                    select.addEventListener("change", (event) =>
                        handleEmbedSelection(event, embeds),
                    );
                };

                const updateSubmitButtonState = () => {
                    const submitButton =
                        document.getElementById("submitButton");
                    let shouldDisable = fileUploadsInProgress > 0;
                    if (shouldDisable) {
                        submitButton.disabled = true;
                    } else {
                        setTimeout(() => {
                            submitButton.disabled = false;
                        }, 2500);
                    }
                };

                const handleEmbedSelection = (event, embeds) => {
                    Object.values(ponds).forEach((pond) => pond.removeFiles());
                    selectedMessageID = event.target.value;
                    const deleteButton =
                        document.getElementById("deleteButton");

                    if (selectedMessageID) {
                        const selectedEmbed = embeds[selectedMessageID];
                        if (selectedEmbed) {
                            populateFormWithEmbedData(selectedEmbed);
                            document.getElementById(
                                "submitButton",
                            ).textContent = "Update Embed";
                            deleteButton.style.display = "inline-block";
                        }
                    } else {
                        clearForm();
                        document.getElementById("submitButton").textContent =
                            "Send Embed";
                        deleteButton.style.display = "none";
                        selectedMessageID = null;
                    }
                };

                const populateFormWithEmbedData = (embedData) => {
                    // Populate form fields with embed data
                    document.getElementById("channelID").value =
                        embedData.channelID;
                    document.getElementById("embedTitle").value =
                        embedData.title || "";
                    document.getElementById("embedColor").value =
                        embedData.color || "";
                    document.getElementById("embedDescription").value =
                        embedData.description || "";
                    document.getElementById("includeTimestamp").checked =
                        embedData.timestamp || false;
                    document.getElementById("authorName").value =
                        embedData.author || "";
                    document.getElementById("embedFooter").value =
                        embedData.footer || "";
                    document.getElementById("messageID").value =
                        embedData.messageID || "";

                    // Handle file inputs
                    const handleFileInput = (pondName, url) => {
                        if (
                            url &&
                            url !== "undefined" &&
                            url !== "null" &&
                            url !== ""
                        ) {
                            ponds[pondName].addFile(url, { type: "local" });
                            $("#embedSettingsForm").attr(
                                `data-${pondName}-url`,
                                url,
                            );
                        }
                    };

                    handleFileInput("authorIcon", embedData.authorIcon);
                    handleFileInput("thumbnail", embedData.thumbnail);
                    handleFileInput("mainImage", embedData.image);

                    // Populate embed fields
                    const fieldContainer = document.getElementById(
                        "embedFieldsContainer",
                    );
                    fieldContainer.innerHTML = "";
                    if (embedData.fields) {
                        embedData.fields.forEach((field) =>
                            addFieldToContainer(
                                field.name,
                                field.value,
                                field.inline,
                            ),
                        );
                    }
                };

                const clearForm = () => {
                    document.getElementById("embedSettingsForm").reset();
                    document.getElementById("embedFieldsContainer").innerHTML =
                        "";
                    document.getElementById("deleteButton").style.display =
                        "none";
                    document.getElementById("submitButton").textContent =
                        "Send Embed";

                    $("#embedSettingsForm").attr("reset-inprogress", true);
                    Object.values(ponds).forEach((pond) => {
                        pond.removeFiles();
                    });
                    $("#embedSettingsForm").removeAttr("reset-inprogress");
                    selectedMessageID = null;
                };

                const addFieldToContainer = (
                    name = "",
                    value = "",
                    inline = false,
                ) => {
                    const fieldContainer = document.createElement("div");
                    fieldContainer.classList.add("embed-field");
                    fieldContainer.innerHTML = `
                        <input class="uk-input embed-field-name" type="text" placeholder="Field Title" value="${name}" />
                        <input class="uk-input uk-margin embed-field-value" type="text" placeholder="Field Value" value="${value}" />
                        <button type="button" class="uk-button uk-margin uk-button-danger remove-field-button">Remove</button>
                        <label>
                            <input type="checkbox" class="uk-checkbox embed-field-inline" ${inline ? "checked" : ""} /> Inline
                        </label>
                    `;
                    document
                        .getElementById("embedFieldsContainer")
                        .appendChild(fieldContainer);

                    fieldContainer
                        .querySelector(".remove-field-button")
                        .addEventListener("click", () =>
                            fieldContainer.remove(),
                        );
                };

                // Event listeners
                const setupEventListeners = () => {
                    document
                        .getElementById("submitButton")
                        .addEventListener("click", handleSubmit);
                    document
                        .getElementById("addFieldButton")
                        .addEventListener("click", () => addFieldToContainer());
                    document
                        .getElementById("deleteButton")
                        .addEventListener("click", handleDelete);
                };

                // Form submission
                const handleSubmit = async () => {
                    const formData = getFormData();
                    if (
                        !formData.channelID ||
                        !formData.embedData.title ||
                        !formData.embedData.description
                    ) {
                        UIkit.notification({
                            message:
                                "Channel, Title, and Description are required.",
                            status: "danger",
                        });
                        return;
                    }

                    try {
                        const response = await fetch("/api/embeds", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify(formData),
                        });

                        const result = await response.json();
                        if (response.ok) {
                            UIkit.notification({
                                message: "Embed sent/updated successfully",
                                status: "success",
                            });
                            clearForm();
                            fetchEmbeds();
                        } else {
                            UIkit.notification({
                                message: `Failed to send/update embed: ${result.error}`,
                                status: "danger",
                            });
                        }
                    } catch (error) {
                        console.error("Error:", error);
                        /*UIkit.notification({
                            message:
                                "An error occurred while sending/updating the embed" +
                                error,
                            status: "danger",
                        });*/
                    }
                };

                const getFormData = () => {
                    const embedFields = Array.from(
                        document.getElementsByClassName("embed-field"),
                    ).map((field) => ({
                        name: field.querySelector(".embed-field-name").value,
                        value: field.querySelector(".embed-field-value").value,
                        inline: field.querySelector(".embed-field-inline")
                            .checked,
                    }));

                    return {
                        channelID: document.getElementById("channelID").value,
                        messageID: document.getElementById("messageID").value,
                        embedData: {
                            title: document.getElementById("embedTitle").value,
                            color: document.getElementById("embedColor").value,
                            description:
                                document.getElementById("embedDescription")
                                    .value,
                            timestamp:
                                document.getElementById("includeTimestamp")
                                    .checked,
                            author: document.getElementById("authorName").value,
                            authorIcon: document
                                .getElementById("embedSettingsForm")
                                .getAttribute("data-authorIcon-url"),
                            thumbnail: document
                                .getElementById("embedSettingsForm")
                                .getAttribute("data-thumbnail-url"),
                            image: document
                                .getElementById("embedSettingsForm")
                                .getAttribute("data-mainImage-url"),
                            fields: embedFields,
                            footer: document.getElementById("embedFooter")
                                .value,
                        },
                    };
                };

                // Delete functionality
                const handleDelete = async () => {
                    if (!selectedMessageID) {
                        UIkit.notification({
                            message: "No embed selected for deletion",
                            status: "warning",
                        });
                        return;
                    }

                    try {
                        const response = await fetch(
                            `/api/embeds/${selectedMessageID}`,
                            { method: "DELETE" },
                        );
                        const result = await response.json();
                        if (response.ok) {
                            UIkit.notification({
                                message: "Embed deleted successfully",
                                status: "success",
                            });
                            clearForm();
                            fetchEmbeds();
                        } else {
                            UIkit.notification({
                                message: `Failed to delete embed: ${result.error}`,
                                status: "danger",
                            });
                        }
                    } catch (error) {
                        console.error("Error:", error);
                        UIkit.notification({
                            message:
                                "An error occurred while deleting the embed",
                            status: "danger",
                        });
                    }
                };

                // Initialize Coloris color picker
                const initializeColorPicker = () => {
                    Coloris({
                        theme: "polaroid",
                        themeMode: localStorage.getItem("color-theme"),
                        alpha: false,
                        format: "rgb",
                        defaultColor: "#000000",
                    });
                };

                // Main initialization
                const initEmbeds = () => {
                    fetchChannels();
                    fetchEmbeds();
                    setupEventListeners();
                    initializeColorPicker();
                };

                // Run initialization when DOM is loaded
                ponds = initializeAllFilePonds();
                window.addEventListener("apiFetchComplete", initEmbeds);
            </script>
        </div>

        <div id="utility" class="page uk-background uk-padding">
            <h1 class="uk-h1 text-foreground" style="margin: 1rem">
                Utility Settings
            </h1>
            <div
                id="utilityCards"
                class="uk-margin"
                style="
                    display: grid;
                    grid-template-columns: repeat(
                        auto-fill,
                        minmax(calc(33.333% - 1rem), 1fr)
                    );
                    gap: 1rem;
                "
            ></div>

            <h2 class="uk-h2 text-foreground" style="margin: 0.5rem">
                Custom Commands
            </h2>
            <div id="customCommandsContainer"></div>

            <button
                id="saveSettings"
                class="uk-button uk-button-primary uk-margin"
                style="margin: 0.5rem"
            >
                Save Settings
            </button>
            <button
                id="addCustomCommand"
                class="uk-button uk-button-primary uk-margin"
            >
                Add Custom Command
            </button>
        </div>

        <div id="customCommandModal" uk-modal>
            <div class="uk-modal-dialog uk-modal-body">
                <h2 class="uk-modal-title text-foreground uk-margin-bottom">
                    Custom Command
                </h2>
                <form id="customCommandForm">
                    <input
                        class="uk-input uk-margin"
                        type="text"
                        placeholder="Command Name"
                        id="commandName"
                        required
                    />
                    <input
                        class="uk-input uk-margin"
                        type="text"
                        placeholder="Description"
                        id="commandDescription"
                        required
                    />
                    <textarea
                        class="uk-textarea uk-margin"
                        placeholder="Messages (one per line)"
                        id="commandMessages"
                    ></textarea>
                    <div id="embedsContainer"></div>
                    <button
                        type="button"
                        class="uk-button uk-button-secondary uk-margin"
                        id="addEmbed"
                    >
                        Add Embed
                    </button>
                    <div class="uk-margin">
                        <button
                            class="uk-button uk-button-primary"
                            type="submit"
                        >
                            Save Command
                        </button>
                        <button
                            class="uk-button uk-button-default uk-modal-close"
                            type="button"
                        >
                            Cancel
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <script>
            document.addEventListener("apiFetchComplete", () => {
                const elements = {
                    utilityCards: document.getElementById("utilityCards"),
                    customCommandsContainer: document.getElementById(
                        "customCommandsContainer",
                    ),
                    saveButton: document.getElementById("saveSettings"),
                    addCustomCommandButton:
                        document.getElementById("addCustomCommand"),
                    customCommandForm:
                        document.getElementById("customCommandForm"),
                    embedsContainer: document.getElementById("embedsContainer"),
                    addEmbedButton: document.getElementById("addEmbed"),
                };

                let editingIndex = -1;

                const renderCards = () => {
                    elements.utilityCards.innerHTML = "";
                    Object.entries(settings.utilitySettings).forEach(
                        ([key, value]) => {
                            if (typeof value === "boolean") {
                                const card = createCard(key, value);
                                elements.utilityCards.appendChild(card);
                            }
                        },
                    );
                };

                const createCard = (commandName, isEnabled) => {
                    const card = document.createElement("div");
                    card.className =
                        "uk-card uk-card-default uk-card-body utility-card";
                    // No need to set inline styles here, as the grid will handle the layout
                    card.innerHTML = `
                        <div class="uk-card-title uk-flex uk-flex-between uk-flex-middle">
                            <h3>/${commandName.replace("Command", "")}</h3>
                            <label>
                                <input class="uk-checkbox" type="checkbox" ${isEnabled ? "checked" : ""} data-command="${commandName}">
                               Enabled
                            </label>
                        </div>
                        <p class="uk-text-muted">Description of the ${commandName.replace("Command", "")} command.</p>
                    `;
                    return card;
                };

                const renderCustomCommands = () => {
                    elements.customCommandsContainer.innerHTML = "";
                    settings.utilitySettings.customCommands.forEach(
                        (command, index) => {
                            const commandElement =
                                document.createElement("div");
                            commandElement.className =
                                "uk-card uk-card-default uk-card-body uk-margin";
                            commandElement.innerHTML = `
                        <h3>${command.name}</h3>
                        <p>${command.description}</p>
                        <button class="uk-button uk-button-primary uk-margin-small-right" onclick="editCustomCommand(${index})">Edit</button>
                        <button class="uk-button uk-button-danger" onclick="deleteCustomCommand(${index})">Delete</button>
                    `;
                            elements.customCommandsContainer.appendChild(
                                commandElement,
                            );
                        },
                    );
                };

                const addEmbed = () => {
                    const embedDiv = document.createElement("div");
                    embedDiv.className = "uk-margin";
                    embedDiv.innerHTML = `
                    <input class="uk-input uk-margin-small" type="text" placeholder="Embed Title" name="embedTitle[]">
                    <textarea class="uk-textarea uk-margin-small" placeholder="Embed Description" name="embedDescription[]"></textarea>
                    <button type="button" class="uk-button uk-button-danger uk-margin-small" onclick="this.parentElement.remove()">Remove Embed</button>
                `;
                    elements.embedsContainer.appendChild(embedDiv);
                };

                const saveSettings = async () => {
                    const checkboxes = document.querySelectorAll(
                        '#utilityCards input[type="checkbox"]',
                    );
                    checkboxes.forEach((checkbox) => {
                        const commandName = checkbox.dataset.command;
                        settings.utilitySettings[commandName] =
                            checkbox.checked;
                    });

                    try {
                        const response = await fetch("/api/settings", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify(settings),
                        });
                        await response.json();
                        UIkit.notification({
                            message: "Settings saved successfully",
                            status: "success",
                        });
                    } catch (error) {
                        console.error("Error saving settings:", error);
                        UIkit.notification({
                            message: "Failed to save settings",
                            status: "danger",
                        });
                    }
                };

                const handleCustomCommandSubmit = (e) => {
                    e.preventDefault();
                    const newCommand = {
                        name: document.getElementById("commandName").value,
                        description:
                            document.getElementById("commandDescription").value,
                        messages: document
                            .getElementById("commandMessages")
                            .value.split("\n")
                            .filter((msg) => msg.trim() !== ""),
                        embeds: Array.from(
                            document.querySelectorAll("#embedsContainer > div"),
                        ).map((div) => ({
                            title: div.querySelector('[name="embedTitle[]"]')
                                .value,
                            description: div.querySelector(
                                '[name="embedDescription[]"]',
                            ).value,
                        })),
                    };

                    if (editingIndex === -1) {
                        settings.utilitySettings.customCommands.push(
                            newCommand,
                        );
                    } else {
                        settings.utilitySettings.customCommands[editingIndex] =
                            newCommand;
                    }

                    renderCustomCommands();
                    UIkit.modal("#customCommandModal").hide();
                    saveSettings();
                };

                window.editCustomCommand = (index) => {
                    editingIndex = index;
                    const command =
                        settings.utilitySettings.customCommands[index];
                    document.getElementById("commandName").value = command.name;
                    document.getElementById("commandDescription").value =
                        command.description;
                    document.getElementById("commandMessages").value =
                        command.messages.join("\n");

                    elements.embedsContainer.innerHTML = "";
                    command.embeds.forEach((embed) => {
                        addEmbed();
                        const lastEmbed =
                            elements.embedsContainer.lastElementChild;
                        lastEmbed.querySelector('[name="embedTitle[]"]').value =
                            embed.title;
                        lastEmbed.querySelector(
                            '[name="embedDescription[]"]',
                        ).value = embed.description;
                    });

                    UIkit.modal("#customCommandModal").show();
                };

                window.deleteCustomCommand = (index) => {
                    settings.utilitySettings.customCommands.splice(index, 1);
                    renderCustomCommands();
                    saveSettings();
                };

                // Event Listeners
                elements.addEmbedButton.addEventListener("click", () =>
                    addEmbed(),
                );
                elements.addCustomCommandButton.addEventListener(
                    "click",
                    () => {
                        editingIndex = -1;
                        elements.customCommandForm.reset();
                        elements.embedsContainer.innerHTML = "";
                        UIkit.modal("#customCommandModal").show();
                    },
                );
                elements.customCommandForm.addEventListener(
                    "submit",
                    handleCustomCommandSubmit,
                );
                elements.saveButton.addEventListener("click", saveSettings);

                // Initialize
                renderCards();
                renderCustomCommands();
            });
        </script>

        <div id="moderation" class="page uk-background uk-padding">
            <h1 class="uk-h1 text-foreground" style="margin: 1rem">
                Moderation Settings
            </h1>

            <div class="uk-card uk-card-default uk-card-body">
                <label class="uk-form-label" for="modRoleInput">
                    Moderator Roles
                </label>
                <div class="uk-flex uk-flex-middle uk-margin-top">
                    <select id="modRoleInput" class="uk-select uk-width-1-2@m">
                        <option value="">Select a role</option>
                    </select>

                    <button
                        id="addModRole"
                        class="uk-button uk-button-primary uk-margin-left"
                    >
                        Add Role
                    </button>
                </div>
                <div id="modRoleList" class="uk-margin-top"></div>
            </div>

            <div
                id="moderationCards"
                class="uk-margin"
                style="
                    display: grid;
                    grid-template-columns: repeat(
                        auto-fill,
                        minmax(calc(33.333% - 1rem), 1fr)
                    );
                    gap: 1rem;
                "
            >
                <!-- Cards will be dynamically inserted here -->
            </div>

            <button
                id="saveModSettings"
                style="margin: 0.5rem"
                class="uk-button uk-button-primary uk-margin-top"
            >
                Save Settings
            </button>
        </div>

        <script>
            document.addEventListener("apiFetchComplete", () => {
                const moderationCards =
                    document.getElementById("moderationCards");
                const saveButton = document.getElementById("saveModSettings");
                const modRoleInput = document.getElementById("modRoleInput");
                const addModRoleButton = document.getElementById("addModRole");
                const modRoleList = document.getElementById("modRoleList");
                populateRoleDropdown();
                renderModRoles();
                renderCards();

                function populateRoleDropdown() {
                    modRoleInput.innerHTML =
                        '<option value="">Select a role</option>';
                    console.log(guildData);
                    guildData.roles.forEach((role) => {
                        const option = document.createElement("option");
                        option.value = role.id;
                        option.textContent = role.name;
                        modRoleInput.appendChild(option);
                    });
                }

                function renderModRoles() {
                    modRoleList.innerHTML = "";
                    settings.moderationSettings.modRoles.forEach((roleId) => {
                        const role = guildData.roles.find(
                            (r) => r.id === roleId,
                        );
                        const roleName = role ? role.name : roleId;

                        const tagSpan = document.createElement("span");
                        tagSpan.className =
                            "uk-tag uk-margin uk-margin-small-right";
                        tagSpan.innerText = roleName;

                        const tagButton = document.createElement("button");
                        tagButton.className = "uk-close-small";
                        tagButton.setAttribute("uk-close", "");
                        tagButton.addEventListener("click", () => {
                            settings.moderationSettings.modRoles =
                                settings.moderationSettings.modRoles.filter(
                                    (id) => id !== roleId,
                                );
                            renderModRoles();
                        });

                        tagSpan.appendChild(tagButton);
                        modRoleList.appendChild(tagSpan);
                    });
                }

                function renderCards() {
                    moderationCards.innerHTML = "";
                    const moderationSettings = settings.moderationSettings;
                    for (const [key, value] of Object.entries(
                        moderationSettings,
                    )) {
                        if (typeof value === "boolean") {
                            const card = createCard(key, value);
                            moderationCards.appendChild(card);
                        }
                    }
                }

                function createCard(commandName, isEnabled) {
                    const card = document.createElement("div");
                    card.className = "uk-card uk-card-default uk-card-body";
                    card.style = "height: 8rem;"; // Remove the width and margin
                    card.innerHTML = `
                            <div class="uk-card-title uk-flex uk-flex-between uk-flex-middle">
                                <h3>/${commandName.replace("Command", "")}</h3>
                                <label>
                                    <input class="uk-checkbox" type="checkbox" ${isEnabled ? "checked" : ""} data-command="${commandName}">
                                    Enabled
                                </label>
                            </div>
                            <p class="uk-text-muted">Description of the ${commandName.replace("Command", "")} command.</p>
                        `;
                    return card;
                }

                addModRoleButton.addEventListener("click", () => {
                    const roleId = modRoleInput.value;
                    if (
                        roleId &&
                        !settings.moderationSettings.modRoles.includes(roleId)
                    ) {
                        settings.moderationSettings.modRoles.push(roleId);
                        modRoleInput.value = "";
                        renderModRoles();
                    }
                });

                saveButton.addEventListener("click", () => {
                    const checkboxes = document.querySelectorAll(
                        '#moderationCards input[type="checkbox"]',
                    );
                    checkboxes.forEach((checkbox) => {
                        const commandName = checkbox.dataset.command;
                        settings.moderationSettings[commandName] =
                            checkbox.checked;
                    });

                    fetch("/api/settings", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify(settings),
                    })
                        .then((response) => response.json())
                        .then((data) => {
                            UIkit.notification({
                                message:
                                    "Moderation settings saved successfully",
                                status: "success",
                            });
                        })
                        .catch((error) => {
                            console.error("Error saving settings:", error);
                            UIkit.notification({
                                message: "Failed to save moderation settings",
                                status: "danger",
                            });
                        });
                });
            });
        </script>
        <div id="automod" class="page uk-background uk-padding">
            <h1 class="uk-h1 text-foreground" style="margin: 1rem">
                Auto Moderation Settings
            </h1>

            <div class="uk-card uk-card-default uk-card-body uk-margin">
                <h3 class="uk-card-title">Ignored Roles</h3>
                <div class="uk-flex uk-flex-middle uk-margin-top">
                    <select
                        class="uk-select uk-width-1-2@m"
                        id="ignoredAutoModRoleInput"
                    >
                        <option value="">Select a role</option>
                    </select>
                    <button
                        class="uk-button uk-button-primary uk-margin-left"
                        id="addIgnoredAutoModRole"
                    >
                        Add Role
                    </button>
                </div>
                <div
                    id="ignoredAutoModRoleList"
                    class="uk-margin-top tag-container"
                ></div>
            </div>

            <div class="uk-grid uk-child-width-1-2@m uk-grid-match" uk-grid>
                <div>
                    <div class="uk-card uk-card-default uk-card-body">
                        <h3 class="uk-card-title">Ignored Channels</h3>
                        <div class="uk-margin-small">
                            <select
                                class="uk-select"
                                id="ignoredAutoModChannelInput"
                            >
                                <option value="">Select a channel</option>
                            </select>
                            <button
                                class="uk-button uk-button-primary uk-margin-small-top"
                                id="addIgnoredAutoModChannel"
                            >
                                Add Channel
                            </button>
                        </div>
                        <div
                            id="ignoredAutoModChannelList"
                            class="uk-margin-small tag-container"
                        ></div>
                    </div>
                </div>
                <div>
                    <div class="uk-card uk-card-default uk-card-body">
                        <h3 class="uk-card-title">Media-Only Channels</h3>
                        <div class="uk-margin-small">
                            <select
                                class="uk-select"
                                id="mediaOnlyChannelInput"
                            >
                                <option value="">Select a channel</option>
                            </select>
                            <button
                                class="uk-button uk-button-primary uk-margin-small-top"
                                id="addMediaOnlyChannel"
                            >
                                Add Channel
                            </button>
                        </div>
                        <div
                            id="mediaOnlyChannelList"
                            class="uk-margin-small tag-container"
                        ></div>
                    </div>
                </div>
                <div>
                    <div class="uk-card uk-card-default uk-card-body">
                        <h3 class="uk-card-title">
                            YouTube Link-Only Channels
                        </h3>
                        <div class="uk-margin-small">
                            <select
                                class="uk-select"
                                id="ytLinkOnlyChannelInput"
                            >
                                <option value="">Select a channel</option>
                            </select>
                            <button
                                class="uk-button uk-button-primary uk-margin-small-top"
                                id="addYtLinkOnlyChannel"
                            >
                                Add Channel
                            </button>
                        </div>
                        <div
                            id="ytLinkOnlyChannelList"
                            class="uk-margin-small tag-container"
                        ></div>
                    </div>
                </div>
                <div>
                    <div class="uk-card uk-card-default uk-card-body">
                        <h3 class="uk-card-title">Twitch Link-Only Channels</h3>
                        <div class="uk-margin-small">
                            <select
                                class="uk-select"
                                id="ttvLinkOnlyChannelInput"
                            >
                                <option value="">Select a channel</option>
                            </select>
                            <button
                                class="uk-button uk-button-primary uk-margin-small-top"
                                id="addTtvLinkOnlyChannel"
                            >
                                Add Channel
                            </button>
                        </div>
                        <div
                            id="ttvLinkOnlyChannelList"
                            class="uk-margin-small tag-container"
                        ></div>
                    </div>
                </div>
            </div>

            <div class="uk-card uk-card-default uk-card-body uk-margin">
                <h3 class="uk-card-title">General Settings</h3>
                <div class="uk-margin-small">
                    <label>
                        <input
                            class="uk-checkbox"
                            type="checkbox"
                            id="discordInvites"
                        />
                        Block Discord Invites
                    </label>
                </div>
                <div class="uk-margin-small">
                    <label>
                        <input
                            class="uk-checkbox"
                            type="checkbox"
                            id="externalLinks"
                        />
                        Block External Links
                    </label>
                </div>
                <div class="uk-margin-small">
                    <label>
                        <input
                            class="uk-checkbox"
                            type="checkbox"
                            id="massMention"
                        />
                        Block Mass Mentions
                    </label>
                </div>
            </div>

            <button
                class="uk-button uk-button-primary"
                id="saveAutoModSettings"
                style="margin: 0.5rem"
            >
                Save Auto Mod Settings
            </button>

            <script>
                document.addEventListener("apiFetchComplete", () => {
                    const autoModPage = document.getElementById("automod");
                    const saveAutoModButton = document.getElementById(
                        "saveAutoModSettings",
                    );
                    guildData.textChannels = guildData.channels.filter(
                        (channel) => channel.type === 0,
                    );
                    renderAutoModSettings();

                    function renderAutoModSettings() {
                        populateDropdown(
                            "ignoredAutoModRoleInput",
                            guildData.roles,
                            true,
                        );
                        populateDropdown(
                            "ignoredAutoModChannelInput",
                            guildData.textChannels,
                        );
                        populateDropdown(
                            "mediaOnlyChannelInput",
                            guildData.textChannels,
                        );
                        populateDropdown(
                            "ytLinkOnlyChannelInput",
                            guildData.textChannels,
                        );
                        populateDropdown(
                            "ttvLinkOnlyChannelInput",
                            guildData.textChannels,
                        );

                        renderList(
                            "ignoredAutoModRole",
                            settings.autoModSettings.ignoredAutoModRoles,
                        );
                        renderList(
                            "ignoredAutoModChannel",
                            settings.autoModSettings.ignoredAutoModChannels,
                        );
                        renderList(
                            "mediaOnlyChannel",
                            settings.autoModSettings.mediaOnlyChannels,
                        );
                        renderList(
                            "ytLinkOnlyChannel",
                            settings.autoModSettings.ytLinkOnlyChannels,
                        );
                        renderList(
                            "ttvLinkOnlyChannel",
                            settings.autoModSettings.ttvLinkOnlyChannels,
                        );

                        document.getElementById("discordInvites").checked =
                            settings.autoModSettings.discordInvites;
                        document.getElementById("externalLinks").checked =
                            settings.autoModSettings.externalLinks;
                        document.getElementById("massMention").checked =
                            settings.autoModSettings.massMention;
                    }

                    function populateDropdown(id, items, isVoice) {
                        const dropdown = document.getElementById(id);
                        if (isVoice) {
                            dropdown.innerHTML =
                                '<option value="">Select a role</option>';
                        } else {
                            dropdown.innerHTML =
                                '<option value="">Select a channel</option>';
                        }
                        items.forEach((item) => {
                            const option = document.createElement("option");
                            option.value = item.id;
                            if (isVoice) {
                                option.textContent = item.name;
                            } else {
                                option.textContent =
                                    "#" + item.name + " - " + item.id;
                            }
                            dropdown.appendChild(option);
                        });
                    }

                    function renderList(type, items) {
                        const list = document.getElementById(`${type}List`);
                        list.innerHTML = "";
                        (items || []).forEach((itemId) => {
                            const tagSpan = document.createElement("span");
                            tagSpan.className =
                                "uk-tag uk-margin uk-margin-small-right";

                            // Find the corresponding name for the ID
                            let itemName = itemId;
                            if (type.includes("Role")) {
                                const role = guildData.roles.find(
                                    (r) => r.id === itemId,
                                );
                                if (role) itemName = role.name;
                            } else if (type.includes("Channel")) {
                                const channel = guildData.textChannels.find(
                                    (c) => c.id === itemId,
                                );
                                if (channel)
                                    itemName =
                                        "#" + channel.name + " - " + itemId;
                            }

                            tagSpan.innerText = itemName;

                            const tagButton = document.createElement("button");
                            tagButton.className = "uk-close-small";
                            tagButton.setAttribute("uk-close", "");
                            tagButton.addEventListener("click", (e) => {
                                settings.autoModSettings[`${type}s`] =
                                    settings.autoModSettings[`${type}s`].filter(
                                        (i) => i !== itemId,
                                    );
                                e.target.closest("span").remove();
                            });

                            tagSpan.appendChild(tagButton);
                            list.appendChild(tagSpan);
                        });
                    }

                    [
                        "ignoredAutoModRole",
                        "ignoredAutoModChannel",
                        "mediaOnlyChannel",
                        "ytLinkOnlyChannel",
                        "ttvLinkOnlyChannel",
                    ].forEach((type) => {
                        document
                            .getElementById(
                                `add${type.charAt(0).toUpperCase() + type.slice(1)}`,
                            )
                            .addEventListener("click", () => {
                                const select = document.getElementById(
                                    `${type}Input`,
                                );
                                const item = select.value;
                                if (
                                    item &&
                                    !settings.autoModSettings[
                                        `${type}s`
                                    ].includes(item)
                                ) {
                                    settings.autoModSettings[`${type}s`].push(
                                        item,
                                    );
                                    select.value = "";
                                    renderList(
                                        type,
                                        settings.autoModSettings[`${type}s`],
                                    );
                                }
                            });
                    });

                    saveAutoModButton.addEventListener("click", () => {
                        settings.autoModSettings.discordInvites =
                            document.getElementById("discordInvites").checked;
                        settings.autoModSettings.externalLinks =
                            document.getElementById("externalLinks").checked;
                        settings.autoModSettings.massMention =
                            document.getElementById("massMention").checked;

                        fetch("/api/settings", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify(settings),
                        })
                            .then((response) => response.json())
                            .then((data) => {
                                UIkit.notification({
                                    message:
                                        "Auto moderation settings saved successfully",
                                    status: "success",
                                });
                            })
                            .catch((error) => {
                                console.error(
                                    "Error saving auto moderation settings:",
                                    error,
                                );
                                UIkit.notification({
                                    message:
                                        "Failed to save auto moderation settings",
                                    status: "danger",
                                });
                            });
                    });
                });
            </script>
        </div>
        <div id="welcome-goodbye" class="page uk-background uk-padding">
            <h1 class="uk-h1 text-foreground" style="margin: 1rem">
                Welcome & Goodbye Settings
            </h1>

            <div class="uk-grid uk-child-width-1-2@m uk-grid-match" uk-grid>
                <div>
                    <div class="uk-card uk-card-default uk-card-body">
                        <h3 class="uk-card-title">Join Message</h3>
                        <div class="uk-margin-small">
                            <label>
                                <input
                                    class="uk-checkbox"
                                    type="checkbox"
                                    id="joinEnabled"
                                />
                                Enable Join Message
                            </label>
                        </div>
                        <div class="uk-margin-small">
                            <select class="uk-select" id="joinChannelId">
                                <option value="">Select a channel</option>
                            </select>
                        </div>
                        <div class="uk-margin-small">
                            <textarea
                                class="uk-textarea"
                                rows="4"
                                id="joinMessage"
                                placeholder="Join Message (Placeholders available: {mention}, {name}, {username}, {tag}, {id}, {servername})"
                            ></textarea>
                        </div>
                        <div class="uk-margin-small">
                            <input
                                class="uk-input"
                                type="text"
                                id="joinColor"
                                placeholder="Color"
                                data-coloris
                            />
                        </div>
                    </div>
                </div>
                <div>
                    <div class="uk-card uk-card-default uk-card-body">
                        <h3 class="uk-card-title">Leave Message</h3>
                        <div class="uk-margin-small">
                            <label>
                                <input
                                    class="uk-checkbox"
                                    type="checkbox"
                                    id="leaveEnabled"
                                />
                                Enable Leave Message
                            </label>
                        </div>
                        <div class="uk-margin-small">
                            <select class="uk-select" id="leaveChannelId">
                                <option value="">Select a channel</option>
                            </select>
                        </div>
                        <div class="uk-margin-small">
                            <textarea
                                class="uk-textarea"
                                rows="4"
                                id="leaveMessage"
                                placeholder="Leave Message (Placeholders available: {mention}, {name}, {username}, {tag}, {id}, {servername})"
                            ></textarea>
                        </div>
                        <div class="uk-margin-small">
                            <input
                                class="uk-input"
                                type="text"
                                id="leaveColor"
                                placeholder="Color"
                                data-coloris
                            />
                        </div>
                    </div>
                </div>
            </div>

            <button
                class="uk-button uk-button-primary uk-margin-top"
                id="saveWelcomeGoodbyeSettings"
            >
                Save Welcome & Goodbye Settings
            </button>

            <script>
                document.addEventListener("apiFetchComplete", () => {
                    const welcomeGoodbyePage =
                        document.getElementById("welcome-goodbye");
                    const saveButton = document.getElementById(
                        "saveWelcomeGoodbyeSettings",
                    );

                    // Filter text channels
                    guildData.textChannels = guildData.channels.filter(
                        (channel) => channel.type === 0,
                    );

                    populateChannelDropdowns();
                    renderWelcomeGoodbyeSettings();
                    function populateChannelDropdowns() {
                        const joinChannelDropdown =
                            document.getElementById("joinChannelId");
                        const leaveChannelDropdown =
                            document.getElementById("leaveChannelId");

                        [joinChannelDropdown, leaveChannelDropdown].forEach(
                            (dropdown) => {
                                dropdown.innerHTML =
                                    '<option value="">Select a channel</option>';
                                guildData.textChannels.forEach((channel) => {
                                    const option =
                                        document.createElement("option");
                                    option.value = channel.id;
                                    option.textContent =
                                        "#" + channel.name + " - " + channel.id;
                                    dropdown.appendChild(option);
                                });
                            },
                        );
                    }

                    function renderWelcomeGoodbyeSettings() {
                        const joinSettings =
                            settings.welcomeGoodbyeSettings.join;
                        const leaveSettings =
                            settings.welcomeGoodbyeSettings.leave;

                        document.getElementById("joinEnabled").checked =
                            joinSettings.enabled;
                        document.getElementById("joinChannelId").value =
                            joinSettings.channelId;
                        document.getElementById("joinMessage").value =
                            joinSettings.message;
                        document.getElementById("joinColor").value =
                            joinSettings.color;

                        document.getElementById("leaveEnabled").checked =
                            leaveSettings.enabled;
                        document.getElementById("leaveChannelId").value =
                            leaveSettings.channelId;
                        document.getElementById("leaveMessage").value =
                            leaveSettings.message;
                        document.getElementById("leaveColor").value =
                            leaveSettings.color;
                    }

                    saveButton.addEventListener("click", () => {
                        settings.welcomeGoodbyeSettings = {
                            join: {
                                enabled:
                                    document.getElementById("joinEnabled")
                                        .checked,
                                channelId:
                                    document.getElementById("joinChannelId")
                                        .value,
                                message: document
                                    .getElementById("joinMessage")
                                    .value.trim(),
                                color: document
                                    .getElementById("joinColor")
                                    .value.trim(),
                            },
                            leave: {
                                enabled:
                                    document.getElementById("leaveEnabled")
                                        .checked,
                                channelId:
                                    document.getElementById("leaveChannelId")
                                        .value,
                                message: document
                                    .getElementById("leaveMessage")
                                    .value.trim(),
                                color: document
                                    .getElementById("leaveColor")
                                    .value.trim(),
                            },
                        };

                        fetch("/api/settings", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify(settings),
                        })
                            .then((response) => response.json())
                            .then((data) => {
                                UIkit.notification({
                                    message:
                                        "Welcome & goodbye settings saved successfully",
                                    status: "success",
                                });
                            })
                            .catch((error) => {
                                console.error(
                                    "Error saving welcome & goodbye settings:",
                                    error,
                                );
                                UIkit.notification({
                                    message:
                                        "Failed to save welcome & goodbye settings",
                                    status: "danger",
                                });
                            });
                    });
                });
            </script>
        </div>
        <div id="auto-responder" class="page uk-background uk-padding">
            <h1 class="uk-h1 text-foreground" style="margin: 1rem">
                Auto Responder Settings
            </h1>

            <div id="autoResponderList"></div>

            <button
                class="uk-button uk-button-primary uk-margin-top"
                id="addAutoResponder"
            >
                Add New Auto Responder
            </button>

            <button
                class="uk-button uk-button-primary uk-margin-top uk-margin-left"
                id="saveAutoResponderSettings"
            >
                Save Auto Responder Settings
            </button>

            <script>
                document.addEventListener("apiFetchComplete", () => {
                    const autoResponderPage =
                        document.getElementById("auto-responder");
                    const autoResponderList =
                        document.getElementById("autoResponderList");
                    const addAutoResponderButton =
                        document.getElementById("addAutoResponder");
                    const saveAutoResponderButton = document.getElementById(
                        "saveAutoResponderSettings",
                    );
                    let textChannels = [];

                    textChannels = guildData.channels.filter(
                        (channel) => channel.type === 0,
                    );
                    renderAutoResponderSettings();

                    function renderAutoResponderSettings() {
                        autoResponderList.innerHTML = "";
                        Object.entries(settings.autoResponderSettings).forEach(
                            ([key, value]) => {
                                const autoResponderElement =
                                    createAutoResponderElement(key, value);
                                autoResponderList.appendChild(
                                    autoResponderElement,
                                );
                            },
                        );
                    }

                    function createAutoResponderElement(key, value) {
                        const element = document.createElement("div");
                        element.className =
                            "uk-card uk-card-default uk-card-body uk-margin";
                        element.innerHTML = `
                            <h3 class="uk-card-title">Auto Responder</h3>
                            <div class="uk-margin-small">
                                <label class="uk-form-label">Trigger Words</label>
                                <div class="tag-container" data-field="triggerWords">
                                   <input class="uk-input tag-input" type="text" placeholder="Press ENTER to add a trigger word">
                                   ${value.triggerWords.map((word) => `<span class="uk-tag uk-margin uk-margin-small-right">${word}<button class="uk-close-small" uk-close></button></span>`).join("")}
                                   </div>
                            </div>
                            <div class="uk-margin-small">
                                <label class="uk-form-label">Responses</label>
                                <textarea class="uk-textarea" rows="3" placeholder="One response per line" data-field="responses">${Array.isArray(value.responses) ? value.responses.join("\n") : ""}</textarea>
                            </div>
                            <div class="uk-margin-small">
                                <label class="uk-form-label">Ignored Channels</label>
                                <div class="uk-flex uk-flex-middle">
                                    <select class="uk-select uk-width-3-4" data-field="channelSelector">
                                        <option value="">Select a channel</option>
                                        ${textChannels.map((channel) => `<option value="${channel.id}">#${channel.name} - ${channel.id}</option>`).join("")}
                                    </select>
                                    <button class="uk-button uk-button-primary uk-width-1-4" data-action="addChannel">Add Channel</button>
                                </div>
                                <div class="uk-margin-small-top" data-field="ignoredChannelList">
                                    ${updateChannelListHTML(value.ignoredChannels)}
                                </div>
                            </div>
                            <div class="uk-margin-small">
                                <label class="uk-form-label">Response Chance</label>
                                <input class="uk-input" type="number" placeholder="Chance of responding (0.0-1.0)" value="${value.chance}" data-field="chance" min="0.0" max="1.0" step="0.01">
                            </div>
                            <div class="uk-margin-small">
                                <label>
                                    <input class="uk-checkbox" type="checkbox" ${value.sendAsReply ? "checked" : ""} data-field="sendAsReply">
                                    Send As Reply
                                </label>
                            </div>
                            <button class="uk-button uk-button-danger uk-button-small" data-action="remove">Remove</button>
                        `;

                        element
                            .querySelector("[data-action='remove']")
                            .addEventListener("click", () => {
                                delete settings.autoResponderSettings[key];
                                renderAutoResponderSettings();
                            });

                        element
                            .querySelector("[data-action='addChannel']")
                            .addEventListener("click", () => {
                                const channelSelector = element.querySelector(
                                    "[data-field='channelSelector']",
                                );
                                const selectedChannelId = channelSelector.value;
                                if (
                                    selectedChannelId &&
                                    !value.ignoredChannels.includes(
                                        selectedChannelId,
                                    )
                                ) {
                                    value.ignoredChannels.push(
                                        selectedChannelId,
                                    );
                                    updateChannelList(
                                        element,
                                        value.ignoredChannels,
                                    );
                                }
                            });

                        element
                            .querySelector("[data-field='ignoredChannelList']")
                            .addEventListener("click", (event) => {
                                if (event.target.closest(".uk-close-small")) {
                                    const button =
                                        event.target.closest(".uk-close-small");
                                    const channelId =
                                        button.getAttribute("data-channel-id");
                                    value.ignoredChannels =
                                        value.ignoredChannels.filter(
                                            (id) => id !== channelId,
                                        );
                                    updateChannelList(
                                        element,
                                        value.ignoredChannels,
                                    );
                                }
                            });

                        // Add tag functionality
                        const tagContainer =
                            element.querySelector(".tag-container");
                        const tagInput = element.querySelector(".tag-input");

                        tagInput.addEventListener("keydown", (e) => {
                            if (
                                e.key === "Enter" &&
                                tagInput.value.trim() !== ""
                            ) {
                                const tag = tagInput.value.trim();
                                value.triggerWords.push(tag);
                                const tagButton =
                                    document.createElement("button");
                                tagButton.className = "uk-close-small";
                                tagButton.setAttribute("uk-close", "");
                                tagButton.addEventListener("click", (e) => {
                                    const tagToRemove =
                                        e.target.parentNode.textContent.trim();
                                    value.triggerWords =
                                        value.triggerWords.filter(
                                            (word) => word !== tagToRemove,
                                        );
                                    e.target.closest("span").remove();
                                });
                                const tagSpan = document.createElement("span");
                                tagSpan.className =
                                    "uk-tag uk-margin uk-margin-small-right";
                                tagSpan.innerText = tag;
                                tagSpan.appendChild(tagButton);
                                tagContainer.appendChild(tagSpan);
                                tagInput.value = "";
                            }
                        });

                        tagContainer.addEventListener("click", (e) => {
                            if (e.target.closest(".uk-close-small")) {
                                const tagToRemove =
                                    e.target.parentNode.textContent.trim();
                                value.triggerWords = value.triggerWords.filter(
                                    (word) => word !== tagToRemove,
                                );
                                e.target.closest("span").remove();
                            }
                        });

                        return element;
                    }

                    function updateChannelListHTML(ignoredChannels) {
                        return ignoredChannels
                            .map((channelId) => {
                                const channel = guildData.channels.find(
                                    (c) => c.id === channelId,
                                );
                                return channel
                                    ? `<span class="uk-tag uk-margin-small-right">#${channel.name} - ${channel.id} <button class="uk-close-small" uk-close data-channel-id="${channelId}"></button></span>`
                                    : "";
                            })
                            .join("");
                    }

                    function updateChannelList(element, ignoredChannels) {
                        const channelListElement = element.querySelector(
                            "[data-field='ignoredChannelList']",
                        );
                        channelListElement.innerHTML =
                            updateChannelListHTML(ignoredChannels);
                    }

                    addAutoResponderButton.addEventListener("click", () => {
                        const newKey = `autoResponder${Object.keys(settings.autoResponderSettings).length + 1}`;
                        settings.autoResponderSettings[newKey] = {
                            triggerWords: [],
                            responses: [],
                            ignoredChannels: [],
                            chance: 1.0,
                            sendAsReply: false,
                        };
                        renderAutoResponderSettings();
                    });

                    saveAutoResponderButton.addEventListener("click", () => {
                        const autoResponders =
                            autoResponderList.querySelectorAll(".uk-card");

                        autoResponders.forEach((responder, index) => {
                            const key = `autoResponder${index + 1}`;
                            settings.autoResponderSettings[key] = {
                                triggerWords: Array.from(
                                    responder.querySelector(".tag-container")
                                        .children,
                                )
                                    .map((tag) =>
                                        tag.textContent.trim().replace(//, ""),
                                    )
                                    .filter((word) => word !== ""), // Filter out empty strings
                                responses: responder
                                    .querySelector("[data-field='responses']")
                                    .value.split("\n")
                                    .map((response) => response.trim())
                                    .filter((word) => word !== ""),
                                ignoredChannels: Array.from(
                                    responder.querySelectorAll(
                                        "[data-field='ignoredChannelList'] .uk-tag button",
                                    ),
                                ).map((button) =>
                                    button.getAttribute("data-channel-id"),
                                ),
                                chance: responder.querySelector(
                                    "[data-field='chance']",
                                ).value,
                                sendAsReply: responder.querySelector(
                                    "[data-field='sendAsReply']",
                                ).checked,
                            };
                        });

                        fetch("/api/settings", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify(settings),
                        })
                            .then((response) => response.json())
                            .then((data) => {
                                UIkit.notification({
                                    message:
                                        "Auto responder settings saved successfully",
                                    status: "success",
                                });
                            })
                            .catch((error) => {
                                console.error(
                                    "Error saving auto responder settings:",
                                    error,
                                );
                                UIkit.notification({
                                    message:
                                        "Failed to save auto responder settings",
                                    status: "danger",
                                });
                            });
                    });
                });
            </script>
        </div>
        <div id="auto-roles" class="page uk-background uk-padding">
            <h1 class="uk-h1 text-foreground" style="margin: 1rem">
                Auto Roles Settings
            </h1>

            <div class="uk-card uk-card-default uk-card-body uk-margin">
                <h3 class="uk-card-title">Roles for New Members</h3>
                <div class="uk-flex uk-flex-middle uk-margin-top">
                    <select
                        class="uk-select uk-width-3-4"
                        id="autoRoleSelector"
                    >
                        <option value="">Select a role</option>
                    </select>
                    <button
                        class="uk-button uk-button-primary uk-width-1-4"
                        id="addAutoRole"
                    >
                        Add Role
                    </button>
                </div>
                <div id="autoRoleList" class="uk-margin-top"></div>
            </div>

            <button
                class="uk-button uk-button-primary"
                id="saveAutoRoleSettings"
                style="margin: 0.5rem"
            >
                Save Auto Role Settings
            </button>

            <script>
                document.addEventListener("apiFetchComplete", () => {
                    const autoRolesPage = document.getElementById("auto-roles");
                    const saveAutoRoleButton = document.getElementById(
                        "saveAutoRoleSettings",
                    );
                    const addAutoRoleButton =
                        document.getElementById("addAutoRole");
                    const autoRoleSelector =
                        document.getElementById("autoRoleSelector");
                    const autoRoleList =
                        document.getElementById("autoRoleList");
                    populateRoleSelector();
                    renderAutoRoleSettings();

                    function populateRoleSelector() {
                        autoRoleSelector.innerHTML =
                            '<option value="">Select a role</option>';
                        guildData.roles.forEach((role) => {
                            const option = document.createElement("option");
                            option.value = role.id;
                            option.textContent = role.name;
                            autoRoleSelector.appendChild(option);
                        });
                    }

                    function renderAutoRoleSettings() {
                        autoRoleList.innerHTML = "";
                        settings.autoRoleSettings.roles.forEach((roleId) => {
                            const role = guildData.roles.find(
                                (r) => r.id === roleId,
                            );
                            if (role) {
                                const roleElement =
                                    document.createElement("span");
                                roleElement.className =
                                    "uk-tag uk-margin-small-right";
                                roleElement.innerHTML = `
                                    ${role.name}
                                    <button class="uk-close-small" uk-close data-role-id="${roleId}"></button>
                                `;
                                autoRoleList.appendChild(roleElement);
                            }
                        });
                    }

                    addAutoRoleButton.addEventListener("click", () => {
                        const selectedRoleId = autoRoleSelector.value;
                        if (
                            selectedRoleId &&
                            !settings.autoRoleSettings.roles.includes(
                                selectedRoleId,
                            )
                        ) {
                            settings.autoRoleSettings.roles.push(
                                selectedRoleId,
                            );
                            renderAutoRoleSettings();
                        }
                    });

                    autoRoleList.addEventListener("click", (event) => {
                        if (event.target.closest(".uk-close-small")) {
                            const button =
                                event.target.closest(".uk-close-small");
                            const roleId = button.getAttribute("data-role-id");
                            settings.autoRoleSettings.roles =
                                settings.autoRoleSettings.roles.filter(
                                    (id) => id !== roleId,
                                );
                            renderAutoRoleSettings();
                        }
                    });

                    saveAutoRoleButton.addEventListener("click", () => {
                        fetch("/api/settings", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify(settings),
                        })
                            .then((response) => response.json())
                            .then((data) => {
                                UIkit.notification({
                                    message:
                                        "Auto role settings saved successfully",
                                    status: "success",
                                });
                            })
                            .catch((error) => {
                                console.error(
                                    "Error saving auto role settings:",
                                    error,
                                );
                                UIkit.notification({
                                    message:
                                        "Failed to save auto role settings",
                                    status: "danger",
                                });
                            });
                    });
                });
            </script>
        </div>
        <div id="logs" class="page uk-background">
            <h1 class="uk-h1 text-foreground" style="margin: 1rem">
                Log Settings
            </h1>
            <div
                id="logSettingsCards"
                class="uk-child-width-1-3@m uk-grid-small uk-grid-match"
                uk-grid
            >
                <!-- Log settings cards will be dynamically rendered here -->
            </div>
            <div class="uk-margin-top">
                <button
                    class="uk-button uk-button-primary uk-width-1-1"
                    id="saveLogSettings"
                >
                    Save Settings
                </button>
            </div>
            <script>
                document.addEventListener("apiFetchComplete", () => {
                    const logSettingsCards =
                        document.getElementById("logSettingsCards");

                    const textChannels = guildData.channels.filter(
                        (channel) => channel.type === 0,
                    );

                    // Render log settings cards
                    Object.entries(settings.logSettings).forEach(
                        ([key, value]) => {
                            const card = document.createElement("div");
                            card.innerHTML = `
                            <div class="uk-card uk-card-default uk-card-body">
                              <div class="uk-grid-small uk-flex-middle" uk-grid>
                                <div class="uk-width-expand">
                                  <h3 class="uk-card-title uk-margin-remove-bottom">${key.charAt(0).toUpperCase() + key.slice(1).replace(/([a-z])([A-Z])/g, "$1 $2")}</h3>
                                </div>
                                <div class="uk-width-auto">
                                  <label class="uk-switch">
                                    <input class="uk-checkbox log-setting-checkbox" type="checkbox" ${value.enabled ? "checked" : ""} ${key === "logMessageCreation" || key === "logMemberLeaves" || key === "logVoiceStateUpdates" || key === "logMemberJoins" ? "disabled" : ""}>
                                    <span class="uk-switch-slider"></span>
                                  </label>
                                </div>
                              </div>
                              <div class="uk-margin-top">
                                <label class="uk-form-label" for="${key}ChannelId">Log Channel:</label>
                                <input type="hidden" id="logSetting" value="${key}">
                                <select class="uk-select log-setting-channel-id" id="${key}ChannelId">
                                  <option value="">No channel</option>
                                  ${textChannels.map((channel) => `<option value="${channel.id}" ${channel.id === value.channelId ? "selected" : ""}>#${channel.name} - (${channel.id})</option>`).join("")}
                                </select>
                              </div>
                            </div>
                          `;
                            logSettingsCards.appendChild(card);
                        },
                    );
                });

                // Save log settings
                const saveLogSettingsButton =
                    document.getElementById("saveLogSettings");
                saveLogSettingsButton.addEventListener("click", () => {
                    const logSettingCheckboxes = document.querySelectorAll(
                        ".log-setting-checkbox",
                    );
                    const logSettingChannelIds = document.querySelectorAll(
                        ".log-setting-channel-id",
                    );
                    const logSettingKeys =
                        document.querySelectorAll("#logSetting");

                    const updatedSettings = {};

                    logSettingCheckboxes.forEach((checkbox, index) => {
                        const key = logSettingKeys[index].value;
                        const channelId = logSettingChannelIds[index].value;
                        updatedSettings[key] = {
                            enabled: checkbox.checked,
                            channelId,
                        };
                    });

                    settings.logSettings = updatedSettings;

                    fetch("/api/settings", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify(settings),
                    })
                        .then((response) => response.json())
                        .then((data) => {
                            UIkit.notification({
                                message: `<div class='uk-flex uk-flex-middle'><span class='uk-flex-none uk-margin-small-right' uk-icon='icon: check; ratio: 0.8'></span> Successfully updated settings.</div>`,
                            });
                        })
                        .catch((error) => {
                            console.error("Error saving settings:", error);
                            UIkit.notification({
                                message: "There was an error!",
                            });
                        });
                });
            </script>
        </div>
        <div id="temporary-channels" class="page uk-background uk-padding">
            <h1 class="uk-h1 text-foreground" style="margin: 1rem">
                Temporary Channel Settings
            </h1>

            <div id="temporaryChannelList"></div>

            <button
                class="uk-button uk-button-primary uk-margin-top"
                id="addTemporaryChannel"
            >
                Add New Temporary Channel
            </button>

            <button
                class="uk-button uk-button-primary uk-margin-top uk-margin-left"
                id="saveTemporaryChannelSettings"
            >
                Save Temporary Channel Settings
            </button>

            <script>
                document.addEventListener("apiFetchComplete", () => {
                    const temporaryChannelsPage =
                        document.getElementById("temporary-channels");
                    const temporaryChannelList = document.getElementById(
                        "temporaryChannelList",
                    );
                    const addTemporaryChannelButton = document.getElementById(
                        "addTemporaryChannel",
                    );
                    const saveTemporaryChannelButton = document.getElementById(
                        "saveTemporaryChannelSettings",
                    );

                    guildData.voiceChannels = guildData.channels.filter(
                        (channel) => channel.type === 2,
                    );
                    renderTemporaryChannelSettings();

                    function renderTemporaryChannelSettings() {
                        temporaryChannelList.innerHTML = "";
                        Object.entries(
                            settings.temporaryChannelSettings,
                        ).forEach(([key, value]) => {
                            const temporaryChannelElement =
                                createTemporaryChannelElement(key, value);
                            temporaryChannelList.appendChild(
                                temporaryChannelElement,
                            );
                        });
                    }

                    function createTemporaryChannelElement(key, value) {
                        const element = document.createElement("div");
                        element.className =
                            "uk-card uk-card-default uk-card-body uk-margin";
                        element.innerHTML = `
                            <h3 class="uk-card-title">Temporary Channel:</h3>
                            <div class="uk-margin-small">
                                <label class="uk-form-label">Trigger Channel</label>
                                <select class="uk-select" data-field="triggerChannel">
                                    <option value="">Select a voice channel</option>
                                    ${guildData.voiceChannels.map((channel) => `<option value="${channel.id}" ${value.triggerChannel === channel.id ? "selected" : ""}>${channel.name} - ${channel.id}</option>`).join("")}
                                </select>
                            </div>
                            <div class="uk-margin-small">
                                <label class="uk-form-label">Category</label>
                                <select class="uk-select" data-field="category">
                                    <option value="">Select a category</option>
                                    ${guildData.categories.map((category) => `<option value="${category.id}" ${value.category === category.id ? "selected" : ""}>${category.name} - ${category.id}</option>`).join("")}
                                </select>
                            </div>
                            <div class="uk-margin-small">
                                <label class="uk-form-label">Max Users (0 for unlimited)</label>
                                <input class="uk-input" type="number" placeholder="Max Users" value="${value.maxUsers}" data-field="maxUsers">
                            </div>
                            <div class="uk-margin-small">
                                <label class="uk-form-label">Temporary Channel Name (Placeholders available: {mention}, {name}, {username}, {tag}, {id}, {servername})</label>
                                <input class="uk-input" type="text" placeholder="Temporary Channel Name" value="${value.channelName}" data-field="channelName">
                            </div>
                            <button class="uk-button uk-button-danger uk-button-small" data-action="remove">Remove</button>
                        `;

                        element
                            .querySelector("[data-action='remove']")
                            .addEventListener("click", () => {
                                delete settings.temporaryChannelSettings[key];
                                renderTemporaryChannelSettings();
                            });

                        return element;
                    }

                    addTemporaryChannelButton.addEventListener("click", () => {
                        const newKey = `tempChannel${Object.keys(settings.temporaryChannelSettings).length + 1}`;
                        settings.temporaryChannelSettings[newKey] = {
                            triggerChannel: "",
                            category: "",
                            maxUsers: 0,
                            channelName: "",
                        };
                        renderTemporaryChannelSettings();
                    });

                    saveTemporaryChannelButton.addEventListener("click", () => {
                        const temporaryChannels =
                            temporaryChannelList.querySelectorAll(".uk-card");
                        settings.temporaryChannelSettings = {};

                        temporaryChannels.forEach((channel, index) => {
                            const key = `tempChannel${index + 1}`;
                            settings.temporaryChannelSettings[key] = {
                                triggerChannel: channel.querySelector(
                                    "[data-field='triggerChannel']",
                                ).value,
                                category: channel.querySelector(
                                    "[data-field='category']",
                                ).value,
                                maxUsers:
                                    parseInt(
                                        channel.querySelector(
                                            "[data-field='maxUsers']",
                                        ).value,
                                    ) || 0,
                                channelName: channel
                                    .querySelector("[data-field='channelName']")
                                    .value.trim(),
                            };
                        });

                        fetch("/api/settings", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify(settings),
                        })
                            .then((response) => response.json())
                            .then((data) => {
                                UIkit.notification({
                                    message:
                                        "Temporary channel settings saved successfully",
                                    status: "success",
                                });
                            })
                            .catch((error) => {
                                console.error(
                                    "Error saving temporary channel settings:",
                                    error,
                                );
                                UIkit.notification({
                                    message:
                                        "Failed to save temporary channel settings",
                                    status: "danger",
                                });
                            });
                    });
                });
            </script>
        </div>
        <div id="ai-chatbot" class="page uk-background uk-padding">
            <h1 class="uk-h1 text-foreground" style="margin: 1rem">
                AI Settings
            </h1>

            <div class="uk-card uk-card-default uk-card-body uk-margin">
                <h3 class="uk-card-title">General Settings</h3>
                <div class="uk-margin-small">
                    <label>
                        <input
                            class="uk-checkbox"
                            type="checkbox"
                            id="aiEnabled"
                        />
                        Enable AI
                    </label>
                </div>
                <div class="uk-margin-small">
                    <label>
                        <input
                            class="uk-checkbox"
                            type="checkbox"
                            id="aiInternet"
                        />
                        Enable Internet Access
                    </label>
                </div>
            </div>

            <div class="uk-card uk-card-default uk-card-body uk-margin">
                <h3 class="uk-card-title">Ignored Channels</h3>
                <div class="uk-margin-small">
                    <select class="uk-select" id="ignoredAIChannelInput">
                        <option value="">Select a channel</option>
                    </select>
                    <button
                        class="uk-button uk-button-primary uk-margin-small-top"
                        id="addIgnoredAIChannel"
                    >
                        Add Channel
                    </button>
                </div>
                <div id="ignoredAIChannelList" class="uk-margin-small"></div>
            </div>

            <div class="uk-card uk-card-default uk-card-body uk-margin">
                <h3 class="uk-card-title">Trigger Words</h3>
                <div class="uk-margin-small">
                    <input
                        class="uk-input"
                        type="text"
                        id="triggerWordInput"
                        placeholder="Trigger Word"
                    />
                    <button
                        class="uk-button uk-button-primary uk-margin-small-top"
                        id="addTriggerWord"
                    >
                        Add Trigger Word
                    </button>
                </div>
                <div id="triggerWordList" class="uk-margin-small"></div>
            </div>

            <div class="uk-card uk-card-default uk-card-body uk-margin">
                <h3 class="uk-card-title">Personality</h3>
                <div class="uk-margin-small">
                    <textarea
                        class="uk-textarea"
                        rows="4"
                        id="personality"
                        placeholder="AI Personality"
                    ></textarea>
                </div>
            </div>

            <div class="uk-card uk-card-default uk-card-body uk-margin">
                <h3 class="uk-card-title">Data Fetches</h3>
                <div class="uk-margin-small">
                    <input
                        class="uk-input"
                        type="text"
                        id="dataFetchInput"
                        placeholder="URL to fetch data from"
                    />
                    <button
                        class="uk-button uk-button-primary uk-margin-small-top"
                        id="addDataFetch"
                    >
                        Add Data Fetch URL
                    </button>
                </div>
                <div id="dataFetchList" class="uk-margin-small"></div>
            </div>

            <button
                class="uk-button uk-button-primary uk-margin-top"
                id="saveAiSettings"
            >
                Save AI Settings
            </button>

            <script>
                document.addEventListener("apiFetchComplete", () => {
                    const aiSettingsPage =
                        document.getElementById("ai-settings");
                    const saveButton =
                        document.getElementById("saveAiSettings");

                    // Filter text channels
                    guildData.textChannels = guildData.channels.filter(
                        (channel) => channel.type === 0,
                    );

                    populateChannelDropdown();
                    renderAiSettings();

                    function populateChannelDropdown() {
                        const dropdown = document.getElementById(
                            "ignoredAIChannelInput",
                        );
                        dropdown.innerHTML =
                            '<option value="">Select a channel</option>';
                        guildData.textChannels.forEach((channel) => {
                            const option = document.createElement("option");
                            option.value = channel.id;
                            option.textContent =
                                "#" + channel.name + " - " + channel.id;
                            dropdown.appendChild(option);
                        });
                    }

                    function renderAiSettings() {
                        document.getElementById("aiEnabled").checked =
                            settings.aiSettings.enabled;
                        document.getElementById("aiInternet").checked =
                            settings.aiSettings.internet;
                        document.getElementById("personality").value =
                            settings.aiSettings.personality || "";

                        renderList(
                            "ignoredAIChannel",
                            settings.aiSettings.ignoredAIChannels,
                        );
                        renderList(
                            "triggerWord",
                            settings.aiSettings.triggerWords,
                        );
                        renderList("dataFetch", settings.aiSettings.dataFetchs);
                    }

                    function renderList(type, items) {
                        const list = document.getElementById(`${type}List`);
                        list.innerHTML = "";
                        if (Array.isArray(items)) {
                            items.forEach((item) => {
                                const tagSpan = document.createElement("span");
                                tagSpan.className =
                                    "uk-tag uk-margin uk-margin-small-right";

                                let itemName = item;
                                if (type === "ignoredAIChannel") {
                                    const channel = guildData.textChannels.find(
                                        (c) => c.id === item,
                                    );
                                    if (channel) itemName = "#" + channel.name;
                                }

                                tagSpan.innerText = itemName;

                                const tagButton =
                                    document.createElement("button");
                                tagButton.className = "uk-close-small";
                                tagButton.setAttribute("uk-close", "");
                                tagButton.addEventListener("click", () => {
                                    settings.aiSettings[`${type}s`] =
                                        settings.aiSettings[`${type}s`].filter(
                                            (id) => id !== item,
                                        );
                                    renderList(
                                        type,
                                        settings.aiSettings[`${type}s`],
                                    );
                                });

                                tagSpan.appendChild(tagButton);
                                list.appendChild(tagSpan);
                            });
                        }
                    }

                    // Add event listeners for adding items
                    ["ignoredAIChannel", "triggerWord", "dataFetch"].forEach(
                        (type) => {
                            document
                                .getElementById(
                                    `add${type.charAt(0).toUpperCase() + type.slice(1)}`,
                                )
                                .addEventListener("click", () => {
                                    const input = document.getElementById(
                                        `${type}Input`,
                                    );
                                    const item = input.value.trim();
                                    if (item) {
                                        if (
                                            !Array.isArray(
                                                settings.aiSettings[`${type}s`],
                                            )
                                        ) {
                                            settings.aiSettings[`${type}s`] =
                                                [];
                                        }
                                        if (
                                            !settings.aiSettings[
                                                `${type}s`
                                            ].includes(item)
                                        ) {
                                            settings.aiSettings[
                                                `${type}s`
                                            ].push(item);
                                            input.value = "";
                                            renderList(
                                                type,
                                                settings.aiSettings[`${type}s`],
                                            );
                                        }
                                    }
                                });
                        },
                    );

                    saveButton.addEventListener("click", () => {
                        settings.aiSettings.enabled =
                            document.getElementById("aiEnabled").checked;
                        settings.aiSettings.internet =
                            document.getElementById("aiInternet").checked;
                        settings.aiSettings.personality = document
                            .getElementById("personality")
                            .value.trim();

                        fetch("/api/settings", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify(settings),
                        })
                            .then((response) => response.json())
                            .then((data) => {
                                UIkit.notification({
                                    message: "AI settings saved successfully",
                                    status: "success",
                                });
                            })
                            .catch((error) => {
                                console.error(
                                    "Error saving AI settings:",
                                    error,
                                );
                                UIkit.notification({
                                    message: "Failed to save AI settings",
                                    status: "danger",
                                });
                            });
                    });
                });
            </script>
        </div>
        <div id="social-alerts" class="page uk-background uk-padding">
            <h1 class="uk-h1 text-foreground" style="margin: 1rem">
                Social Alert Settings
            </h1>

            <div id="socialAlertList"></div>

            <button
                class="uk-button uk-button-primary uk-margin-top"
                id="addSocialAlert"
            >
                Add New Social Alert
            </button>

            <button
                class="uk-button uk-button-primary uk-margin-top uk-margin-left"
                id="saveSocialAlertSettings"
            >
                Save Social Alert Settings
            </button>

            <script>
                document.addEventListener("apiFetchComplete", () => {
                    const socialAlertsPage =
                        document.getElementById("social-alerts");
                    const socialAlertList =
                        document.getElementById("socialAlertList");
                    const addSocialAlertButton =
                        document.getElementById("addSocialAlert");
                    const saveSocialAlertButton = document.getElementById(
                        "saveSocialAlertSettings",
                    );

                    textChannels = guildData.channels.filter(
                        (channel) => channel.type === 0,
                    );
                    renderSocialAlertSettings();

                    function renderSocialAlertSettings() {
                        socialAlertList.innerHTML = "";
                        Object.entries(settings.socialAlertSettings).forEach(
                            ([key, value]) => {
                                const socialAlertElement =
                                    createSocialAlertElement(key, value);
                                socialAlertList.appendChild(socialAlertElement);
                            },
                        );
                    }

                    function createSocialAlertElement(key, value) {
                        const element = document.createElement("div");
                        element.className =
                            "uk-card uk-card-default uk-card-body uk-margin";
                        element.dataset.socialAlertKey = key;
                        element.innerHTML = `
                            <h3 class="uk-card-title">Social Alert</h3>
                            <div class="uk-margin-small">
                                <label class="uk-form-label">Social ID (Twitch/YouTube)</label>
                                <input class="uk-input" type="text" placeholder="Youtube Channel ID or Twitch Username" value="${value.socialId || ""}" data-field="socialId">
                            </div>
                            <div class="uk-margin-small">
                                <label class="uk-form-label">Display Name (Must match Youtube Channel Name for the API, does not matter for Twitch)</label>
                                <input class="uk-input" type="text" placeholder="Youtube Channel ID or Twitch Username" value="${value.socialName || ""}" data-field="socialName">
                            </div>
                            <div class="uk-margin-small">
                                <label class="uk-form-label">Channel to Send Alert</label>
                                <div class="uk-flex uk-flex-middle">
                                    <select class="uk-select uk-width-3-4" data-field="channelSelector">
                                        <option value="">Select a channel</option>
                                        ${textChannels.map((channel) => `<option value="${channel.id}" ${value.channelId === channel.id ? "selected" : ""}>#${channel.name} - ${channel.id}</option>`).join("")}
                                    </select>
                                </div>
                            </div>
                            <div class="uk-margin-small">
                                <label class="uk-form-label">Type</label>
                                <select class="uk-select" data-field="type">
                                    <option value="twitch" ${value.type === "twitch" ? "selected" : ""}>Twitch</option>
                                    <option value="youtube" ${value.type === "youtube" ? "selected" : ""}>YouTube</option>
                                </select>
                            </div>
                            <div class="uk-margin-small">
                                <label class="uk-form-label">Message (Supports Placeholders: {author}, {uploadedANewVideoOrStartedStreaming})</label>
                                <textarea class="uk-textarea" rows="3" placeholder="Message to include in embed" data-field="message">${value.message || ""}</textarea>
                            </div>
                            <div class="uk-margin-small">
                                <label class="uk-form-label">Whitelist Title Words</label>
                                <input class="uk-input" type="text" placeholder="Comma-separated words, leave empty to disable" value="${Array.isArray(value.whitelistTitleWords) ? value.whitelistTitleWords.join(", ") : ""}" data-field="whitelistTitleWords">
                            </div>
                            <div class="uk-margin-small">
                                <label class="uk-form-label">Roles to Mention</label>
                                <div class="uk-flex uk-flex-middle">
                                    <select class="uk-select uk-width-3-4" data-field="roleSelector">
                                        <option value="">Select a role</option>
                                        ${guildData.roles.map((role) => `<option value="${role.id}">${role.name}</option>`).join("")}
                                    </select>
                                    <button class="uk-button uk-button-primary uk-width-1-4" data-action="addRole">Add Role</button>
                                </div>
                                <div class="uk-margin-small-top" data-field="roleList">
                                    ${updateRoleListHTML(value.rolesToMention)}
                                </div>
                            </div>
                            <button class="uk-button uk-button-danger uk-button-small" data-action="remove">Remove</button>
                        `;

                        element
                            .querySelector("[data-action='remove']")
                            .addEventListener("click", () => {
                                delete settings.socialAlertSettings[key];
                                renderSocialAlertSettings();
                            });

                        element
                            .querySelector("[data-action='addRole']")
                            .addEventListener("click", () => {
                                const roleSelector = element.querySelector(
                                    "[data-field='roleSelector']",
                                );
                                const selectedRoleId = roleSelector.value;
                                if (selectedRoleId) {
                                    const selectedRole = guildData.roles.find(
                                        (role) => role.id === selectedRoleId,
                                    );
                                    if (
                                        selectedRole &&
                                        !value.rolesToMention.includes(
                                            selectedRoleId,
                                        )
                                    ) {
                                        value.rolesToMention.push(
                                            selectedRoleId,
                                        );
                                        updateRoleList(
                                            element,
                                            value.rolesToMention,
                                        );
                                    }
                                }
                            });

                        element
                            .querySelector("[data-field='roleList']")
                            .addEventListener("click", (event) => {
                                if (event.target.closest(".uk-close-small")) {
                                    const button =
                                        event.target.closest(".uk-close-small");
                                    const roleId =
                                        button.getAttribute("data-role-id");
                                    value.rolesToMention =
                                        value.rolesToMention.filter(
                                            (id) => id !== roleId,
                                        );
                                    updateRoleList(
                                        element,
                                        value.rolesToMention,
                                    );
                                }
                            });

                        return element;
                    }

                    function updateRoleListHTML(rolesToMention) {
                        return rolesToMention
                            .map((roleId) => {
                                const role = guildData.roles.find(
                                    (r) => r.id === roleId,
                                );
                                return role
                                    ? `<span class="uk-tag uk-margin-small-right">${role.name} <button class="uk-close-small" uk-close data-role-id="${roleId}"></button></span>`
                                    : "";
                            })
                            .join("");
                    }

                    function updateRoleList(element, rolesToMention) {
                        const roleListElement = element.querySelector(
                            "[data-field='roleList']",
                        );
                        roleListElement.innerHTML =
                            updateRoleListHTML(rolesToMention);
                    }

                    addSocialAlertButton.addEventListener("click", () => {
                        const newKey = `socialAlert${Object.keys(settings.socialAlertSettings).length + 1}`;
                        settings.socialAlertSettings[newKey] = {
                            socialId: "",
                            socialName: "",
                            channelId: "",
                            type: "twitch",
                            message: "",
                            whitelistTitleWords: [],
                            rolesToMention: [],
                        };
                        renderSocialAlertSettings();
                    });

                    saveSocialAlertButton.addEventListener("click", () => {
                        const socialAlerts =
                            socialAlertList.querySelectorAll(".uk-card");

                        socialAlerts.forEach((alert, index) => {
                            const key = `socialAlert${index + 1}`;
                            settings.socialAlertSettings[key] = {
                                socialId: alert
                                    .querySelector("[data-field='socialId']")
                                    .value.trim(),
                                socialName: alert
                                    .querySelector("[data-field='socialName']")
                                    .value.trim(),
                                channelId: alert.querySelector(
                                    "[data-field='channelSelector']",
                                ).value,
                                type: alert.querySelector("[data-field='type']")
                                    .value,
                                message: alert
                                    .querySelector("[data-field='message']")
                                    .value.trim(),
                                whitelistTitleWords: alert
                                    .querySelector(
                                        "[data-field='whitelistTitleWords']",
                                    )
                                    .value.split(",")
                                    .map((word) => word.trim())
                                    .filter((word) => word !== ""),
                                rolesToMention: Array.from(
                                    alert.querySelectorAll(
                                        "[data-field='roleList'] .uk-tag button",
                                    ),
                                ).map((button) =>
                                    button.getAttribute("data-role-id"),
                                ),
                            };
                        });

                        fetch("/api/settings", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify(settings),
                        })
                            .then((response) => response.json())
                            .then((data) => {
                                UIkit.notification({
                                    message:
                                        "Social alert settings saved successfully",
                                    status: "success",
                                });
                            })
                            .catch((error) => {
                                console.error(
                                    "Error saving social alert settings:",
                                    error,
                                );
                                UIkit.notification({
                                    message:
                                        "Failed to save social alert settings",
                                    status: "danger",
                                });
                            });
                    });
                });
            </script>
        </div>
        <div id="control-panel-logs" class="page uk-background">
            <div class="uk-container uk-margin-top">
                <table class="uk-table uk-table-hover">
                    <thead>
                        <tr>
                            <th>Action</th>
                            <th class="uk-text-right">Time</th>
                        </tr>
                    </thead>
                    <tbody id="logs-table-body">
                        <!-- Logs will be inserted here -->
                    </tbody>
                </table>
            </div>
            <script>
                function loadControlPanelLogs() {
                    // Populate logs table
                    const tableBody =
                        document.getElementById("logs-table-body");
                    tableBody.innerHTML = ""; // Clear existing content

                    if (controlLogs && controlLogs.length > 0) {
                        controlLogs.sort(
                            (a, b) =>
                                new Date(b.timestamp) - new Date(a.timestamp),
                        );

                        controlLogs.forEach((log) => {
                            const row = document.createElement("tr");

                            const actionCell = document.createElement("td");
                            actionCell.innerHTML = `
                                  <div class="text-foreground" style="font-weight: bold">${log.user} ${log.message}.</div>
                                  <div class="uk-text-muted">${log.email} - (${log.id})</div>
                              `;

                            const timeCell = document.createElement("td");
                            timeCell.className =
                                "uk-text-right text-foreground";
                            timeCell.textContent = formatTimestamp(
                                log.timestamp,
                            );

                            row.appendChild(actionCell);
                            row.appendChild(timeCell);
                            tableBody.appendChild(row);
                        });
                    }
                }

                function formatTimestamp(timestamp) {
                    const now = new Date();
                    const logDate = new Date(timestamp);
                    const diffMs = now - logDate;
                    const diffSecs = Math.floor(diffMs / 1000);
                    const diffMins = Math.floor(diffSecs / 60);
                    const diffHours = Math.floor(diffMins / 60);
                    const diffDays = Math.floor(diffHours / 24);
                    const diffMonths = Math.floor(diffDays / 30);

                    if (diffMonths > 0) {
                        return `${diffMonths} month${diffMonths > 1 ? "s" : ""} ago`;
                    } else if (diffDays > 0) {
                        return `${diffDays} day${diffDays > 1 ? "s" : ""} ago`;
                    } else if (diffHours > 0) {
                        return `${diffHours} hour${diffHours > 1 ? "s" : ""} ago`;
                    } else if (diffMins > 0) {
                        return `${diffMins} minute${diffMins > 1 ? "s" : ""} ago`;
                    } else {
                        return "Just now";
                    }
                }

                // Call this function when the control panel logs page is loaded
                document.addEventListener("apiFetchComplete", () => {
                    loadControlPanelLogs();
                });
            </script>
        </div>
        <div id="bot-settings" class="page uk-background uk-padding">
            <h1 class="uk-h1 text-foreground" style="margin: 1rem">
                Bot Presence Settings
            </h1>

            <div class="uk-card uk-card-default uk-card-body uk-margin">
                <h3 class="uk-card-title">Presence Status</h3>
                <div class="uk-margin-small">
                    <label>
                        Status:
                        <select id="presenceStatus" class="uk-select">
                            <option value="online">Online</option>
                            <option value="idle">Idle</option>
                            <option value="dnd">Do Not Disturb</option>
                            <option value="invisible">Invisible</option>
                        </select>
                    </label>
                </div>
            </div>

            <div class="uk-card uk-card-default uk-card-body uk-margin">
                <h3 class="uk-card-title">Activities</h3>
                <div class="uk-margin-small">
                    <label>
                        Activity Type:
                        <select id="activityTypeSelect" class="uk-select">
                            <option value="0">Playing</option>
                            <option value="1">Streaming</option>
                            <option value="2">Listening</option>
                            <option value="3">Watching</option>
                            <option value="4">Custom</option>
                            <option value="5">Competing</option>
                        </select>
                    </label>
                </div>
                <div class="uk-margin-small">
                    <label>
                        Activity Name:
                        <input
                            class="uk-input"
                            type="text"
                            id="activityNameInput"
                            placeholder="Enter activity name"
                        />
                    </label>
                </div>
                <button class="uk-button uk-button-primary" id="addActivity">
                    Add Activity
                </button>
                <div id="activitiesList" class="uk-margin-small">
                    <!-- Activities will be dynamically added here -->
                </div>
            </div>

            <div class="uk-card uk-card-default uk-card-body uk-margin">
                <h3 class="uk-card-title">Change Interval</h3>
                <div class="uk-margin-small">
                    <label>
                        Change Interval (minutes):
                        <input
                            class="uk-input"
                            type="number"
                            id="changeInterval"
                            value="1"
                        />
                    </label>
                </div>
            </div>

            <button
                class="uk-button uk-button-primary uk-margin-top"
                id="saveBotSettings"
            >
                Save Bot Settings
            </button>
            <script>
                document.addEventListener("apiFetchComplete", () => {
                    const botSettingsPage =
                        document.getElementById("bot-settings");
                    const saveBotSettingsButton =
                        document.getElementById("saveBotSettings");
                    const addActivityButton =
                        document.getElementById("addActivity");
                    const activitiesList =
                        document.getElementById("activitiesList");
                    const presenceStatusSelect =
                        document.getElementById("presenceStatus");
                    const changeIntervalInput =
                        document.getElementById("changeInterval");

                    presenceStatusSelect.value =
                        settings.botPresenceSettings.status;
                    changeIntervalInput.value =
                        settings.botPresenceSettings.changeInterval;

                    // Render existing activities
                    renderActivities(settings.botPresenceSettings.activities);

                    // Render activities list
                    function renderActivities(activities) {
                        activitiesList.innerHTML = ""; // This line might cause the error if activitiesList is null
                        activities.forEach((activity) => {
                            const activityElement =
                                document.createElement("div");
                            strActivity =
                                activity.type.charAt(0).toUpperCase() +
                                activity.type.slice(1).toLowerCase();
                            activityElement.className =
                                "uk-flex uk-flex-middle uk-margin-small-bottom";
                            activityElement.innerHTML = `
                                <span class="uk-margin-small-right">${strActivity} ${activity.name}</span>
                                <button class="uk-button uk-button-danger uk-button-small" data-type="${activity.type}" data-name="${activity.name}">Remove</button>
                            `;
                            activitiesList.appendChild(activityElement);
                        });
                    }

                    // Event listener for adding new activity
                    addActivityButton.addEventListener("click", () => {
                        const typeSelect =
                            document.getElementById("activityTypeSelect");
                        const nameInput =
                            document.getElementById("activityNameInput");

                        const type =
                            typeSelect.options[
                                typeSelect.selectedIndex
                            ].text.toUpperCase();
                        const name = nameInput.value.trim();

                        if (type && name) {
                            const newActivity = {
                                type: type,
                                name: name,
                            };
                            activitiesList.appendChild(
                                createActivityElement(newActivity),
                            );

                            // Clear input fields after adding activity
                            typeSelect.value = "";
                            nameInput.value = "";
                        }
                    });

                    // Function to create activity element
                    function createActivityElement(activity) {
                        const activityElement = document.createElement("div");
                        strActivity =
                            activity.type.charAt(0).toUpperCase() +
                            activity.type.slice(1).toLowerCase();
                        activityElement.className =
                            "uk-flex uk-flex-middle uk-margin-small-bottom";
                        activityElement.innerHTML = `
                            <span class="uk-margin-small-right">${strActivity} ${activity.name}</span>
                            <button class="uk-button uk-button-danger uk-button-small" data-type="${activity.type}" data-name="${activity.name}">Remove</button>
                        `;
                        return activityElement;
                    }

                    // Event listener for removing activity
                    activitiesList.addEventListener("click", (e) => {
                        if (e.target.tagName === "BUTTON") {
                            const type = e.target.dataset.type;
                            const name = e.target.dataset.name;
                            // Remove activity from UI
                            e.target.parentNode.remove();
                        }
                    });

                    // Event listener for saving bot settings
                    saveBotSettingsButton.addEventListener("click", () => {
                        const activities = Array.from(
                            activitiesList.children,
                        ).map((activityElement) => ({
                            type: activityElement.querySelector("button")
                                .dataset.type,
                            name: activityElement.querySelector("button")
                                .dataset.name,
                        }));

                        settings.botPresenceSettings = {
                            status: presenceStatusSelect.value,
                            activities: activities,
                            changeInterval: parseInt(changeIntervalInput.value),
                        };

                        // Save settings via API
                        fetch("/api/settings", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify(settings),
                        })
                            .then((response) => response.json())
                            .then((data) => {
                                UIkit.notification({
                                    message: "Bot settings saved successfully",
                                    status: "success",
                                });
                            })
                            .catch((error) => {
                                console.error(
                                    "Error saving bot settings:",
                                    error,
                                );
                                UIkit.notification({
                                    message: "Failed to save bot settings",
                                    status: "danger",
                                });
                            });
                    });
                });
            </script>
        </div>

        <div id="mod-actions" class="page uk-background">
            <div class="uk-container uk-margin-top">
                <table class="uk-table uk-table-hover">
                    <thead>
                        <tr>
                            <th>Action</th>
                            <th class="uk-text-right">Time</th>
                        </tr>
                    </thead>
                    <tbody id="mod-actions-table-body">
                        <!-- Audit log entries will be inserted here -->
                    </tbody>
                </table>
            </div>
        </div>
        <script>
            document.addEventListener("apiFetchComplete", () => {
                fetch("/api/audit-log")
                    .then((response) => response.json())
                    .then((data) => {
                        const tbody = document.getElementById(
                            "mod-actions-table-body",
                        );

                        data.forEach((log) => {
                            const row = document.createElement("tr");

                            const actionCell = document.createElement("td");
                            const logTarget = log.targetID
                                ? `${log.targetType} (${log.targetID})`
                                : "";
                            actionCell.innerHTML = `
                                                        <div class="text-foreground" style="font-weight: bold">${log.executorTag} ${log.action} ${logTarget}.</div>
                                                        <div class="uk-text-muted">${log.executorTag} (#${log.executorID})</div>
                                                    `;

                            const timeCell = document.createElement("td");
                            timeCell.className =
                                "uk-text-right text-foreground";
                            timeCell.textContent = formatTimestamp(
                                log.createdAt,
                            );

                            row.appendChild(actionCell);
                            row.appendChild(timeCell);
                            tbody.appendChild(row);
                        });
                    })
                    .catch((error) => {
                        console.error("Error fetching audit logs:", error);
                    });
            });
        </script>

        <script>
            showDiv("overview");

            // Adding click event to switch selection on click
            document.querySelectorAll(".sidebar-menu > *").forEach((item) => {
                item.addEventListener("click", function () {
                    // Remove the 'uk-button-secondary' class from all buttons and set them to primary
                    document
                        .querySelectorAll(".sidebar-menu > *")
                        .forEach((btn) => {
                            btn.classList.remove("uk-button-secondary");
                            btn.classList.add("uk-button-default");
                        });
                    // Add the 'uk-button-secondary' class to the clicked button
                    this.classList.remove("uk-button-default");
                    this.classList.add("uk-button-secondary");
                });
            });

            function showDiv(route) {
                // Hide all views
                document.querySelectorAll(".page").forEach((page) => {
                    page.style.display = "none";
                });
                // Show the correct view
                document.getElementById(route).style.display = "block";
            }

            function notify(message, status) {
                UIkit.notification({
                    message: message,
                    status: status,
                });
            }

            function logout() {
                fetch("/logout")
                    .then(() => (window.location.href = "/login"))
                    .catch((error) => console.error("Error:", error));
            }

            // Show the default view
        </script>
        <script src="https://cdn.jsdelivr.net/npm/uikit@3.21.5/dist/js/uikit.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/uikit@3.21.5/dist/js/uikit-icons.min.js"></script>
    </body>
</html>
