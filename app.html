<html>
    <head>
        <title>Dashboard</title>
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
        />
        <script
            src="https://code.jquery.com/jquery-3.7.1.min.js"
            integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
            crossorigin="anonymous"
        ></script>
        <link
            rel="stylesheet"
            href="https://unpkg.com/franken-ui-releases@0.0.13/dist/default.min.css"
        />
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <style>
            .sidebar {
                width: 20rem;
                height: 100%;
                padding: 2rem;
                box-sizing: border-box;
                float: left;
                display: flex;
                flex-direction: column;
                align-items: center; /* Centering the buttons vertically */
                overflow-y: auto; /* Added to enable scrolling */
            }
            .sidebar-header {
                margin-bottom: 2rem;
                text-align: center; /* Centering the text horizontally */
            }
            .sidebar-header-title {
                font-size: 1.5rem;
                margin: 0;
            }
            .sidebar-menu {
                padding: 0;
                margin: 0;
                width: 90%;
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
                align-items: center; /* Centering the buttons horizontally */
            }

            body {
                display: flex;
                justify-content: center;
                align-items: center;
                margin: 0;
                padding: 0;
            }

            .page {
                height: 90%;
                width: 80%;
                overflow: auto;
                border-radius: 1rem;
                margin: 1rem;
                padding: 1rem;
            }

            *::-webkit-scrollbar {
                display: none;
            }
        </style>
        <script>
            // On page load or when changing themes, best to add inline in `head` to avoid FOUC
            if (
                localStorage.getItem("color-theme") === "dark" ||
                (!("color-theme" in localStorage) &&
                    window.matchMedia("(prefers-color-scheme: dark)").matches)
            ) {
                document.documentElement.classList.add("dark");
            } else {
                document.documentElement.classList.remove("dark");
            }
        </script>
    </head>
    <body class="uk-background-default">
        <div class="sidebar">
            <div class="sidebar-header">
                <h1 class="sidebar-header-title text-foreground">
                    OS Discord Bot
                </h1>
            </div>
            <div class="sidebar-menu">
                <button
                    class="uk-width-1-1 uk-button uk-button-secondary"
                    onclick="showDiv('overview')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: home; ratio: 0.8"
                    ></span>
                    Overview
                </button>
                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('server-settings')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: cog; ratio: 0.8"
                    ></span>
                    Server Settings
                </button>
                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('embed-messages')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: grid; ratio: 0.8"
                    ></span>
                    Embed Messages
                </button>
                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('utility')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: crosshairs; ratio: 0.8"
                    ></span>
                    Utility
                </button>
                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('moderation')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: ban; ratio: 0.8"
                    ></span>
                    Moderation
                </button>
                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('automod')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: lock; ratio: 0.8"
                    ></span>
                    AutoMod
                </button>
                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('welcome-goodbye')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: social; ratio: 0.8"
                    ></span>
                    Welcome/Goodbye
                </button>
                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('auto-responder')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: reply; ratio: 0.8"
                    ></span>
                    Auto Responder
                </button>
                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('leveling-system')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: refresh; ratio: 0.8"
                    ></span>
                    Leveling System
                </button>
                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('auto-roles')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: users; ratio: 0.8"
                    ></span>
                    Auto Roles
                </button>
                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('logs')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: database; ratio: 0.8"
                    ></span>
                    Logs
                </button>
                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('colors')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: lifesaver; ratio: 0.8"
                    ></span>
                    Colors
                </button>
                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('self-assignable-roles')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: user; ratio: 0.8"
                    ></span>
                    Self-Assignable Roles
                </button>
                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('starboard')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: star; ratio: 0.8"
                    ></span>
                    Starboard
                </button>
                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('temporary-channels')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: clock; ratio: 0.8"
                    ></span>
                    Temporary Channels
                </button>
                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('anti-raid')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: world; ratio: 0.8"
                    ></span>
                    Anti-Raid
                </button>
                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('social-alerts')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: bell; ratio: 0.8"
                    ></span>
                    Social Alerts
                </button>
                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('control-panel-logs')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: rss; ratio: 0.8"
                    ></span>
                    Control Panel Logs
                </button>
                <button
                    class="uk-width-1-1 uk-button uk-button-default"
                    onclick="showDiv('mod-actions')"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: history; ratio: 0.8"
                    ></span>
                    Mod Actions
                </button>
            </div>
            <div
                style="
                    display: flex;
                    width: 90%;
                    align-items: center;
                    justify-content: space-between;
                    margin-top: 1rem;
                "
            >
                <button
                    class="uk-width-1-1 uk-button uk-button-danger"
                    onclick="logout()"
                    style="justify-content: left"
                >
                    <span
                        style="margin-right: 0.5rem"
                        uk-icon="icon: sign-out; ratio: 0.8"
                    ></span>
                    Logout
                </button>
                <style>
                    #theme-toggle:hover {
                        cursor: pointer;
                    }
                </style>
                <a
                    id="theme-toggle"
                    class="uk-icon-button; text-foreground"
                    style="margin-left: 1rem"
                    uk-icon="paint-bucket"
                ></a>
                <script>
                    var themeToggleBtn =
                        document.getElementById("theme-toggle");

                    themeToggleBtn.addEventListener("click", function () {
                        // if set via local storage previously
                        if (localStorage.getItem("color-theme")) {
                            if (
                                localStorage.getItem("color-theme") === "light"
                            ) {
                                document.documentElement.classList.add("dark");
                                localStorage.setItem("color-theme", "dark");
                            } else {
                                document.documentElement.classList.remove(
                                    "dark",
                                );
                                localStorage.setItem("color-theme", "light");
                            }

                            // if NOT set via local storage previously
                        } else {
                            if (
                                document.documentElement.classList.contains(
                                    "dark",
                                )
                            ) {
                                document.documentElement.classList.remove(
                                    "dark",
                                );
                                localStorage.setItem("color-theme", "light");
                            } else {
                                document.documentElement.classList.add("dark");
                                localStorage.setItem("color-theme", "dark");
                            }
                        }
                    });
                </script>
            </div>
        </div>
        <div id="overview" class="page uk-background-secondary">
            <style>
                .card-container {
                    display: flex;
                    flex-direction: row;
                    justify-content: space-around;
                    flex-wrap: wrap;
                    gap: 1rem;
                    align-items: center;
                }
                .uk-card {
                    position: relative;
                }
                .card-overlay {
                    position: absolute;
                    top: 1rem;
                    left: 1rem;
                    font-size: 1.5rem;
                    font-weight: bold;
                    z-index: 10;
                }
                .header-container {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 1rem;
                }
                .guild-info {
                    display: flex;
                    align-items: center;
                    gap: 1rem;
                }
            </style>

            <div class="header-container">
                <div class="guild-info">
                    <img
                        id="guildIcon"
                        src=""
                        alt="Guild Icon"
                        class="uk-border-circle"
                        width="64"
                        height="64"
                    />
                    <h2 id="guildName" class="uk-h1 text-foreground"></h2>
                </div>
            </div>

            <style>
                .no-padding {
                    position: relative;
                    width: 400px;
                    height: 200px;
                    overflow: hidden; /* Hide overflow to ensure the chart doesn't exceed bounds */
                    padding: 0 !important;
                }

                #totalMembersChart,
                #onlineMembersChart,
                #joinsChart,
                #leavesChart,
                #messagesChart {
                    position: absolute;
                    width: 405px !important; /* Slightly larger width */
                    height: 130px !important; /* Slightly larger height */
                    top: 75px; /* Adjust top to center vertically, starting at 80% of parent height */
                    left: -2.5px; /* Adjust left to center horizontally */
                }
            </style>

            <div class="card-container">
                <div class="uk-card uk-card-default uk-card-body no-padding">
                    <div class="card-overlay" id="totalMembersText">
                        0 Total Members
                    </div>
                    <canvas
                        id="totalMembersChart"
                        height="130"
                        width="405"
                    ></canvas>
                </div>
                <div class="uk-card uk-card-default uk-card-body no-padding">
                    <div class="card-overlay" id="onlineMembersText">
                        Online Members: 0
                    </div>
                    <canvas
                        id="onlineMembersChart"
                        height="130"
                        width="405"
                    ></canvas>
                </div>
                <div class="uk-card uk-card-default uk-card-body no-padding">
                    <div class="card-overlay" id="joins24HoursText">
                        Joins (Last 24 Hours): 0
                    </div>
                    <canvas id="joinsChart" height="130" width="405"></canvas>
                </div>
                <div class="uk-card uk-card-default uk-card-body no-padding">
                    <div class="card-overlay" id="leaves24HoursText">
                        Leaves (Last 24 Hours): 0
                    </div>
                    <canvas id="leavesChart" height="130" width="405"></canvas>
                </div>
                <div class="uk-card uk-card-default uk-card-body no-padding">
                    <div class="card-overlay" id="messages24HoursText">
                        Messages (Last 24 Hours): 0
                    </div>
                    <canvas
                        id="messagesChart"
                        height="130"
                        width="405"
                    ></canvas>
                </div>
            </div>

            <script>
            document.addEventListener("DOMContentLoaded", async () => {
              const response = await fetch("/api/guild");
              const data = await response.json();
              const { guildData, stats, logs } = data;

              // Update guild information
              document.getElementById("guildIcon").src = guildData.icon;
              document.getElementById("guildName").textContent = guildData.name;

              const totalMembers = stats[stats.length - 1]?.totalMembers || 0;
              const onlineMembers = stats[stats.length - 1]?.onlineMembers || 0;

              document.getElementById("totalMembersText").textContent = `${totalMembers} Total Members`;
              document.getElementById("onlineMembersText").textContent = `${onlineMembers} Online Members`;

              // Get current timestamp and timestamp for 24 hours ago
              const now = new Date();
              const twentyFourHoursAgo = new Date(now.getTime() - 24 * 60 * 60 * 1000);

              // Filter logs for the last 24 hours
              const logsLast24Hours = logs.filter(log => new Date(log.timestamp) >= twentyFourHoursAgo);

              // Function to group logs by 30 minutes and sum the values
              function groupLogsByHalfHour(logs, type) {
                const grouped = {};

                // Initialize all 30-minute intervals in the last 24 hours with 0
                for (let d = new Date(twentyFourHoursAgo); d <= now; d.setMinutes(d.getMinutes() + 30)) {
                  const halfHour = Math.floor(d.getMinutes() / 30) * 30;
                  const key = `${d.getHours()}:${halfHour === 0 ? '00' : halfHour}`;
                  grouped[key] = 0;
                }

                // Add log counts to the respective 30-minute intervals
                logs.filter(log => log.type === type).forEach(log => {
                  const timestamp = new Date(log.timestamp);
                  const halfHour = Math.floor(timestamp.getMinutes() / 30) * 30;
                  const key = `${timestamp.getHours()}:${halfHour === 0 ? '00' : halfHour}`;

                  grouped[key] += 1;
                });

                return Object.entries(grouped).map(([time, count]) => ({
                  x: time,
                  y: count
                }));
              }

              // Count joins, leaves, and messages in the last 24 hours
              const joins = groupLogsByHalfHour(logsLast24Hours, "join");
              const leaves = groupLogsByHalfHour(logsLast24Hours, "left");
              const messages = groupLogsByHalfHour(logsLast24Hours, "new-message");

              document.getElementById("joins24HoursText").textContent = `${joins.reduce((acc, cur) => acc + cur.y, 0)} Joins (Last 24 Hours)`;
              document.getElementById("leaves24HoursText").textContent = `${leaves.reduce((acc, cur) => acc + cur.y, 0)} Leaves (Last 24 Hours)`;
              document.getElementById("messages24HoursText").textContent = `${messages.reduce((acc, cur) => acc + cur.y, 0)} Messages (Last 24 Hours)`;

              // Prepare data for charts
              const timestamps = stats.map(interval => new Date(interval.timestamp).toLocaleTimeString());
              const totalMembersData = stats.map(interval => interval.totalMembers);
              const onlineMembersData = stats.map(interval => interval.onlineMembers);

              const chartOptions = {
                scales: {
                  x: { display: false },
                  y: { display: false, beginAtZero: true },
                },
                plugins: {
                  legend: { display: false },
                },
              };

              const ctxTotalMembers = document.getElementById("totalMembersChart").getContext("2d");
              const ctxOnlineMembers = document.getElementById("onlineMembersChart").getContext("2d");
              const ctxJoins = document.getElementById("joinsChart").getContext("2d");
              const ctxLeaves = document.getElementById("leavesChart").getContext("2d");
              const ctxMessages = document.getElementById("messagesChart").getContext("2d");

              const gradient = ctxTotalMembers.createLinearGradient(0, 0, 0, ctxTotalMembers.canvas.height);
              gradient.addColorStop(0, "rgba(75, 192, 192, 1)");
              gradient.addColorStop(1, "rgba(153, 102, 255, 1)");

              // Create charts
              new Chart(ctxTotalMembers, {
                type: "line",
                data: {
                  labels: timestamps,
                  datasets: [{ label: "Total Members", data: totalMembersData, borderColor: "rgba(75, 192, 192, 1)", backgroundColor: gradient, borderWidth: 2, fill: true }],
                },
                options: chartOptions,
              });

              new Chart(ctxOnlineMembers, {
                type: "line",
                data: {
                  labels: timestamps,
                  datasets: [{ label: "Online Members", data: onlineMembersData, borderColor: "rgba(54, 162, 235, 1)", backgroundColor: gradient, borderWidth: 2, fill: true }],
                },
                options: chartOptions,
              });

              new Chart(ctxJoins, {
                type: "line",
                data: {
                  labels: joins.map(data => data.x),
                  datasets: [{ label: "Joins", data: joins.map(data => data.y), borderColor: "rgba(255, 206, 86, 1)", backgroundColor: gradient, borderWidth: 2, fill: true }],
                },
                options: chartOptions,
              });

              new Chart(ctxLeaves, {
                type: "line",
                data: {
                  labels: leaves.map(data => data.x),
                  datasets: [{ label: "Leaves", data: leaves.map(data => data.y), borderColor: "rgba(255, 99, 132, 1)", backgroundColor: gradient, borderWidth: 2, fill: true }],
                },
                options: chartOptions,
              });

              new Chart(ctxMessages, {
                type: "line",
                data: {
                  labels: messages.map(data => data.x),
                  datasets: [{ label: "Messages", data: messages.map(data => data.y), borderColor: "rgba(153, 102, 255, 1)", backgroundColor: gradient, borderWidth: 2, fill: true }],
                },
                options: chartOptions,
              });
            });

            </script>
        </div>
        <div id="server-settings" class="page uk-background-secondary">
            <h1 class="uk-h1 text-foreground" style="margin: 1rem">
                Server Settings
            </h1>
            <div
                id="serverSettingsForm"
                class="uk-card uk-card-default uk-card-body"
            >
                <input type="hidden" id="guildId" value="<%= guild.id %>" />

                <div class="uk-margin">
                    <label
                        class="uk-form-label"
                        for="defaultMessageNotifications"
                        >Default Notification Settings:</label
                    >
                    <select
                        class="uk-select"
                        id="defaultMessageNotifications"
                        name="defaultMessageNotifications"
                    >
                        <option value="0">All Messages</option>
                        <option value="1">Only @mentions</option>
                    </select>
                </div>

                <div class="uk-margin">
                    <label class="uk-form-label" for="explicitContentFilter"
                        >Explicit Content Filter:</label
                    >
                    <select
                        class="uk-select"
                        id="explicitContentFilter"
                        name="explicitContentFilter"
                    >
                        <option value="0">Disabled</option>
                        <option value="1">Members without roles</option>
                        <option value="2">All members</option>
                    </select>
                </div>

                <div class="uk-margin">
                    <label class="uk-form-label" for="systemChannelId"
                        >System Messages Channel ID:</label
                    >
                    <input
                        class="uk-input"
                        type="text"
                        id="systemChannelId"
                        name="systemChannelId"
                        placeholder="Channel ID"
                    />
                </div>

                <div class="uk-margin">
                    <label class="uk-form-label" for="preferredLocale"
                        >Server Region:</label
                    >
                    <input
                        class="uk-input"
                        type="text"
                        id="preferredLocale"
                        name="preferredLocale"
                        placeholder="e.g., en-US, ja"
                    />
                </div>

                <div class="uk-margin">
                    <label class="uk-form-label checkbox-label">
                        <input
                            class="uk-checkbox"
                            type="checkbox"
                            id="sendWelcomeMessage"
                            name="sendWelcomeMessage"
                        />
                        Send a random welcome message when someone joins this
                        server.
                    </label>
                </div>

                <div class="uk-margin">
                    <label class="uk-form-label checkbox-label">
                        <input
                            class="uk-checkbox"
                            type="checkbox"
                            id="promptWelcomeSticker"
                            name="promptWelcomeSticker"
                        />
                        Prompt members to reply to welcome messages with a
                        sticker.
                    </label>
                </div>

                <div class="uk-margin">
                    <label class="uk-form-label checkbox-label">
                        <input
                            class="uk-checkbox"
                            type="checkbox"
                            id="sendBoostMessage"
                            name="sendBoostMessage"
                        />
                        Send a message when someone boosts this server.
                    </label>
                </div>

                <div class="uk-margin">
                    <label class="uk-form-label checkbox-label">
                        <input
                            class="uk-checkbox"
                            type="checkbox"
                            id="sendHelpfulTips"
                            name="sendHelpfulTips"
                        />
                        Send helpful tips for server setup.
                    </label>
                </div>

                <div class="uk-margin">
                    <label class="uk-form-label checkbox-label">
                        <input
                            class="uk-checkbox"
                            type="checkbox"
                            id="sendPurchaseMessage"
                            name="sendPurchaseMessage"
                        />
                        Send a message when someone purchases a Server Product
                        or Server Subscription.
                    </label>
                </div>

                <div class="uk-margin">
                    <label class="uk-form-label checkbox-label">
                        <input
                            class="uk-checkbox"
                            type="checkbox"
                            id="promptSubscriptionSticker"
                            name="promptSubscriptionSticker"
                        />
                        Prompt members to reply to Server Subscription
                        congratulation messages with a sticker.
                    </label>
                </div>

                <div class="uk-card-footer uk-flex uk-flex-between">
                    <button
                        type="button"
                        class="uk-button uk-button-default"
                        id="updateButton"
                    >
                        Save Settings
                    </button>
                </div>
            </div>

            <script>
                document.addEventListener("DOMContentLoaded", async () => {
                    const response = await fetch(`/api/guild`);
                    const { guildData } = await response.json();

                    document.getElementById(
                        "defaultMessageNotifications",
                    ).value = guildData.defaultMessageNotifications;
                    document.getElementById("explicitContentFilter").value =
                        guildData.explicitContentFilter;
                    document.getElementById("systemChannelId").value =
                        guildData.systemChannelId || "";
                    document.getElementById("preferredLocale").value =
                        guildData.preferredLocale;
                    document.getElementById("sendWelcomeMessage").checked =
                        guildData.sendWelcomeMessage;
                    document.getElementById("promptWelcomeSticker").checked =
                        guildData.promptWelcomeSticker;
                    document.getElementById("sendBoostMessage").checked =
                        guildData.sendBoostMessage;
                    document.getElementById("sendPurchaseMessage").checked =
                        guildData.sendPurchaseMessage;
                    document.getElementById(
                        "promptSubscriptionSticker",
                    ).checked = guildData.promptSubscriptionSticker;
                    document.getElementById("sendHelpfulTips").checked =
                        guildData.sendHelpfulTips;

                    document
                        .getElementById("updateButton")
                        .addEventListener("click", async () => {
                            const updatedData = {
                                defaultMessageNotifications:
                                    document.getElementById(
                                        "defaultMessageNotifications",
                                    ).value,
                                explicitContentFilter: document.getElementById(
                                    "explicitContentFilter",
                                ).value,
                                systemChannelId:
                                    document.getElementById("systemChannelId")
                                        .value,
                                preferredLocale:
                                    document.getElementById("preferredLocale")
                                        .value,
                                sendWelcomeMessage:
                                    document.getElementById(
                                        "sendWelcomeMessage",
                                    ).checked,
                                promptWelcomeSticker: document.getElementById(
                                    "promptWelcomeSticker",
                                ).checked,
                                sendBoostMessage:
                                    document.getElementById("sendBoostMessage")
                                        .checked,
                                sendPurchaseMessage: document.getElementById(
                                    "sendPurchaseMessage",
                                ).checked,
                                promptSubscriptionSticker:
                                    document.getElementById(
                                        "promptSubscriptionSticker",
                                    ).checked,
                                sendHelpfulTips:
                                    document.getElementById("sendHelpfulTips")
                                        .checked,
                            };

                            const updateResponse = await fetch(`/api/guild`, {
                                method: "POST",
                                headers: {
                                    "Content-Type": "application/json",
                                },
                                body: JSON.stringify(updatedData),
                            });

                            if (updateResponse.ok) {
                                UIkit.notification({
                                    message:
                                        "<div class='uk-flex uk-flex-middle'><span class='uk-flex-none uk-margin-small-right' uk-icon='icon: check; ratio: 0.8'></span> Succesfully updated settings.</div>",
                                });
                            } else {
                                UIkit.notification({
                                    message: "There was an error!",
                                });
                            }
                        });
                });
            </script>
        </div>
        <div id="embed-messages" class="page uk-background-secondary">
                <h1 class="uk-h1 text-foreground" style="margin: 1rem">
                    Embed Settings
                </h1>
                <form
                    id="embedSettingsForm"
                    class="uk-card uk-card-default uk-card-body"
                >
                    <div class="uk-margin">
                        <label class="uk-form-label" for="channelID"
                            >Channel ID:</label
                        >
                        <input
                            class="uk-input"
                            type="text"
                            id="channelID"
                            name="channelID"
                            placeholder="Enter channel ID"
                        />
                    </div>

                    <div class="uk-margin">
                        <label class="uk-form-label" for="embedTitle"
                            >Embed Title:</label
                        >
                        <input
                            class="uk-input"
                            type="text"
                            id="embedTitle"
                            name="embedTitle"
                            placeholder="Enter embed title"
                        />
                    </div>

                    <div class="uk-margin">
                        <label class="uk-form-label" for="embedDescription"
                            >Embed Description:</label
                        >
                        <textarea
                            class="uk-textarea"
                            id="embedDescription"
                            name="embedDescription"
                            rows="3"
                            placeholder="Enter embed description"
                        ></textarea>
                    </div>

                    <div class="uk-margin">
                        <label class="uk-form-label" for="embedImage"
                            >Embed Image URL:</label
                        >
                        <input
                            class="uk-input"
                            type="text"
                            id="embedImage"
                            name="embedImage"
                            placeholder="Enter image URL"
                        />
                    </div>

                    <div class="uk-margin">
                        <label class="uk-form-label">Embed Fields:</label>
                        <div id="embedFieldsContainer">
                            <!-- Embed fields will be added here dynamically -->
                        </div>
                        <button
                            type="button"
                            class="uk-button uk-button-default"
                            id="addFieldButton"
                        >
                            Add Field
                        </button>
                    </div>

                    <div class="uk-margin">
                        <label class="uk-form-label" for="existingEmbeds"
                            >Select Embed to Update:</label
                        >
                        <select class="uk-select" id="existingEmbeds">
                            <option value="">Select Embed</option>
                        </select>
                    </div>

                    <input type="hidden" id="messageID" name="messageID" />

                    <div class="uk-card-footer uk-flex uk-flex-between">
                        <button
                            type="button"
                            class="uk-button uk-button-primary"
                            id="submitButton"
                        >
                            Send Embed
                        </button>
                    </div>
                </form>
            </div>

            <script>
                async function fetchEmbeds() {
                    try {
                        const response = await fetch("/api/embeds");
                        const embeds = await response.json();
                        const select =
                            document.getElementById("existingEmbeds");
                        select.innerHTML =
                            '<option value="">Select Embed</option>';
                        embeds.forEach((embed) => {
                            const option = document.createElement("option");
                            option.value = embed.key;
                            option.textContent =
                                embed.data.title + " - " + embed.key;
                            select.appendChild(option);
                        });

                        document
                            .getElementById("existingEmbeds")
                            .addEventListener("change", (event) => {
                                const selectedEmbedKey = event.target.value;
                                if (selectedEmbedKey) {
                                    const selectedEmbed = embeds.find(
                                        (embed) =>
                                            embed.key === selectedEmbedKey,
                                    );
                                    if (selectedEmbed) {
                                        populateFormWithEmbedData(
                                            selectedEmbed.data,
                                        );
                                        document.getElementById(
                                            "submitButton",
                                        ).textContent = "Update Embed";
                                    } else {
                                        console.log(selectedEmbedKey, embeds);
                                        UIkit.notification({
                                            message:
                                                "Failed to find the selected embed",
                                            status: "danger",
                                        });
                                    }
                                } else {
                                    clearForm();
                                    document.getElementById(
                                        "submitButton",
                                    ).textContent = "Send Embed";
                                }
                            });
                    } catch (error) {
                        console.error("Failed to fetch embeds", error);
                    }
                }

                function populateFormWithEmbedData(embedData) {
                    document.getElementById("channelID").value = embedData.channelID;
                    document.getElementById("embedTitle").value = embedData.title;
                    document.getElementById("embedDescription").value = embedData.description;
                    document.getElementById("embedImage").value = embedData.image || "";
                    document.getElementById("messageID").value = embedData.messageID || ""; // Set the messageID

                    const fieldContainer = document.getElementById("embedFieldsContainer");
                    fieldContainer.innerHTML = "";
                    embedData.fields.forEach((field) => {
                        addFieldToContainer(field.name, field.value, field.inline);
                    });
                }

                function clearForm() {
                    document.getElementById("embedSettingsForm").reset();
                    document.getElementById("embedFieldsContainer").innerHTML =
                        "";
                }

                document.getElementById("submitButton").addEventListener("click", async () => {
                    const channelID = document.getElementById("channelID").value;
                    const title = document.getElementById("embedTitle").value;
                    const description = document.getElementById("embedDescription").value;
                    const image = document.getElementById("embedImage").value;
                    const messageID = document.getElementById("messageID").value; // Get the messageID

                    if (!channelID || !title || !description) {
                        UIkit.notification({ message: "Channel ID, Title, and Description are required.", status: 'danger' });
                        return;
                    }

                    const embedFields = Array.from(document.getElementsByClassName("embed-field")).map((field) => ({
                        name: field.querySelector(".embed-field-name").value,
                        value: field.querySelector(".embed-field-value").value,
                        inline: field.querySelector(".embed-field-inline").checked,
                    }));

                    const embedData = { title, description, fields: embedFields, image };

                    try {
                        const response = await fetch("/api/embeds", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({ embedData, channelID, messageID }), // Include messageID
                        });

                        const result = await response.json();
                        if (response.ok) {
                            UIkit.notification({ message: "Embed sent/updated successfully", status: 'success' });
                            clearForm();
                            fetchEmbeds();
                        } else {
                            UIkit.notification({ message: `Failed to send/update embed: ${result.error}`, status: 'danger' });
                        }
                    } catch (error) {
                        console.error("Error:", error);
                        UIkit.notification({ message: "An error occurred while sending/updating the embed", status: 'danger' });
                    }
                });

                function addFieldToContainer(
                    name = "",
                    value = "",
                    inline = false,
                ) {
                    const fieldContainer = document.createElement("div");
                    fieldContainer.classList.add("embed-field");
                    fieldContainer.innerHTML = `
                        <input class="uk-input embed-field-name" type="text" placeholder="Field Name" value="${name}" />
                        <input class="uk-input embed-field-value" type="text" placeholder="Field Value" value="${value}" />
                        <button type="button" class="uk-button uk-button-danger remove-field-button">Remove</button>
                        <label>
                            <input type="checkbox" class="uk-checkbox embed-field-inline" ${inline ? "checked" : ""} /> Inline
                        </label>
                    `;
                    document
                        .getElementById("embedFieldsContainer")
                        .appendChild(fieldContainer);

                    fieldContainer
                        .querySelector(".remove-field-button")
                        .addEventListener("click", () => {
                            fieldContainer.remove();
                        });
                }

                document
                    .getElementById("addFieldButton")
                    .addEventListener("click", () => {
                        addFieldToContainer();
                    });

                window.addEventListener("DOMContentLoaded", fetchEmbeds);
            </script>
        </div>

        <div id="utility" class="page uk-background-secondary">
            <!-- utility page -->
        </div>
        <div id="moderation" class="page uk-background-secondary">
            <!-- moderation page -->
        </div>
        <div id="automod" class="page uk-background-secondary">
            <!-- automod page -->
        </div>
        <div id="welcome-goodbye" class="page uk-background-secondary">
            <!-- welcome goodbye page -->
        </div>
        <div id="auto-responder" class="page uk-background-secondary">
            <!-- auto responder page -->
        </div>
        <div id="leveling-system" class="page uk-background-secondary">
            <!-- leveling system page -->
        </div>
        <div id="auto-roles" class="page uk-background-secondary">
            <!-- auto roles page -->
        </div>
        <div id="logs" class="page uk-background-secondary">
          <h2 class="uk-heading-line uk-text-center"><span>Log Settings</span></h2>
          <div id="logSettingsCards" class="uk-child-width-1-3@m uk-grid-small uk-grid-match" uk-grid>
            <!-- Log settings cards will be dynamically rendered here -->
          </div>
          <div class="uk-margin-top">
            <button class="uk-button uk-button-primary uk-width-1-1" id="saveLogSettings">Save Settings</button>
          </div>
          <script>
            // Fetch log settings
            let settingsFetch = {};
            fetch('/api/settings')
              .then(response => response.json())
              .then(data => {
                settingsFetch = data || {};
                const logSettingsCards = document.getElementById('logSettingsCards');

                // Render log settings cards
                Object.entries(settingsFetch.logSettings).forEach(([key, value]) => {
                  const card = document.createElement('div');
                  card.innerHTML = `
                    <div class="uk-card uk-card-default uk-card-body">
                      <div class="uk-grid-small uk-flex-middle" uk-grid>
                        <div class="uk-width-expand">
                          <h3 class="uk-card-title uk-margin-remove-bottom">${key.charAt(0).toUpperCase() + key.slice(1).replace(/([a-z])([A-Z])/g, '$1 $2')}</h3>
                        </div>
                        <div class="uk-width-auto">
                          <label class="uk-switch">
                            <input class="uk-checkbox log-setting-checkbox" type="checkbox" ${value.enabled ? 'checked' : ''}>
                            <span class="uk-switch-slider"></span>
                          </label>
                        </div>
                      </div>
                      <div class="uk-margin-top">
                        <label class="uk-form-label" for="${key}ChannelId">Channel ID:</label>
                        <input type="hidden" id="logSetting" value="${key}">
                        <input class="uk-input log-setting-channel-id" type="text" id="${key}ChannelId" value="${value.channelId}" placeholder="Channel ID">
                      </div>
                    </div>
                  `;
                  logSettingsCards.appendChild(card);
                });
              })
              .catch(error => console.error('Error fetching settings:', error));

            // Save log settings
            const saveLogSettingsButton = document.getElementById('saveLogSettings');
            saveLogSettingsButton.addEventListener('click', () => {
              const logSettingCheckboxes = document.querySelectorAll('.log-setting-checkbox');
              const logSettingChannelIds = document.querySelectorAll('.log-setting-channel-id');
              const logSettingKeys = document.querySelectorAll('#logSetting');

              const updatedSettings = {};

              logSettingCheckboxes.forEach((checkbox, index) => {
                const key = logSettingKeys[index].value;
                const channelId = logSettingChannelIds[index].value;
                updatedSettings[key] = {
                  enabled: checkbox.checked,
                  channelId
                };
              });

              settingsFetch.logSettings = updatedSettings;

              fetch('/api/settings', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify(settingsFetch)
              })
                .then(response => response.json())
                .then(data => {
                  UIkit.notification({
                    message: `<div class='uk-flex uk-flex-middle'><span class='uk-flex-none uk-margin-small-right' uk-icon='icon: check; ratio: 0.8'></span> Successfully updated settings.</div>`
                  });
                })
                .catch(error => {
                  console.error('Error saving settings:', error);
                  UIkit.notification({
                    message: "There was an error!"
                  });
                });
            });
          </script>
        </div>

        <div id="colors" class="page uk-background-secondary">
            <!-- colors page -->
        </div>
        <div id="self-assignable-roles" class="page uk-background-secondary">
            <!-- self assignable roles page -->
        </div>
        <div id="starboard" class="page uk-background-secondary">
            <!-- starboard page -->
        </div>
        <div id="temporary-channels" class="page uk-background-secondary">
            <!-- temporary channels page -->
        </div>
        <div id="anti-raid" class="page uk-background-secondary">
            <!-- anti-raid page -->
        </div>
        <div id="social-alerts" class="page uk-background-secondary">
            <!-- social alerts page -->
        </div>
        <div id="control-panel-logs" class="page uk-background-secondary">
            <!-- control panel logs page -->
        </div>
        <div id="mod-actions" class="page uk-background-secondary">
            <!-- mod actions page -->
        </div>

        <script>
            function showDiv(route) {
                // Hide all views
                document.querySelectorAll(".page").forEach((page) => {
                    page.style.display = "none";
                });
                // Show the correct view
                document.getElementById(route).style.display = "block";
            }

            function logout() {
                fetch("/logout")
                    .then(() => (window.location.href = "/login"))
                    .catch((error) => console.error("Error:", error));
            }

            // Adding click event to switch selection on click
            document.querySelectorAll(".sidebar-menu > *").forEach((item) => {
                item.addEventListener("click", function () {
                    // Remove the 'uk-button-secondary' class from all buttons and set them to primary
                    document
                        .querySelectorAll(".sidebar-menu > *")
                        .forEach((btn) => {
                            btn.classList.remove("uk-button-secondary");
                            btn.classList.add("uk-button-default");
                        });
                    // Add the 'uk-button-secondary' class to the clicked button
                    this.classList.remove("uk-button-default");
                    this.classList.add("uk-button-secondary");
                });
            });

            // Show the default view
            showDiv("overview");
        </script>
        <script src="https://cdn.jsdelivr.net/npm/uikit@3.21.5/dist/js/uikit.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/uikit@3.21.5/dist/js/uikit-icons.min.js"></script>
    </body>
</html>
